<div class="documentation"><h1 id="asset" id="asset">Asset</h1>
<p>This module provides the framework for storing/retrieving assets. </p>
<p>The asset module requires an <a class="source-link" href="https://github.com/travetto/travetto/tree/master/module/asset/src/service/source.ts" target="_blank" null><code class="inline">AssetSource</code></a> to provide functionality for reading and writing files. </p>
<app-section-header headerType="install">Primary</app-section-header>
<pre><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> @travetto/asset</code></pre><p>You will need to select one of the available providers to serve as your <code class="inline">AssetSource</code>.</p>
<app-section-header headerType="install">Secondary</app-section-header>
<pre><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> @travetto/asset-<span class="token punctuation">{{ '{' }}</span>provider<span class="token punctuation">{{ '}' }}</span></code></pre><p>Reading of and writing assets uses the <a class="source-link" href="https://github.com/travetto/travetto/tree/master/module/asset/src/service/asset.ts" target="_blank" null><code class="inline">AssetService</code></a>.  Below you can see an example dealing with a userâ€™s profile image.</p>
<app-section-header headerType="code">User Profile Images</app-section-header>
<pre><code class="language-typescript">@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UserProfileService</span> <span class="token punctuation">{{ '{' }}</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token parameter"><span class="token keyword">private</span> asset<span class="token operator">:</span> <span class="token type">AssetService</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> model<span class="token operator">:</span> ModelService</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span><span class="token punctuation">{{ '}' }}</span>

  <span class="token keyword">async</span> <span class="token function">saveProfileImage</span><span class="token punctuation">(</span><span class="token parameter">userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> image<span class="token operator">:</span> Asset</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>asset<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token type">User</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span>profileImage <span class="token operator">=</span> path<span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token type">User</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>

  <span class="token keyword">async</span> <span class="token function">getProfileImage</span><span class="token punctuation">(</span><span class="token parameter">userId<span class="token operator">:</span><span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>asset<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>profileImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre><h2 id="naming-strategies">Naming Strategies</h2>
<p>By default, the assets are stored by path, as specified in the <a class="source-link" href="https://github.com/travetto/travetto/tree/master/module/asset/src/types.ts" target="_blank" null><code class="inline">Asset</code></a> object.  This is standard, and expected, but some finer control may be desired.  In addition to standard naming, the module also supports naming by hash, to prevent duplicate storage of the same files with different hashes. This is generally useful when surfacing a lot of public (within the application) user-generated content.</p>
<p>The underlying contract for a <a class="source-link" href="https://github.com/travetto/travetto/tree/master/module/asset/src/naming.ts" target="_blank" null><code class="inline">AssetNamingStrategy</code></a> looks like:</p>
<app-section-header headerType="code">AssetNamingStrategy</app-section-header>
<pre><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">AssetNamingStrategy</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token function">getPath</span><span class="token punctuation">(</span><span class="token type">Asset</span><span class="token operator">:</span> <span class="token type">Asset</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ '}' }}</span></code></pre><p>By extending this, and making it <code class="decorator inline">@Injectable</code>, the naming strategy will become the default for the system.  </p>
<h2 id="advanced-usage">Advanced Usage</h2>
<p>In addition to reading and writing, you can also retrieve information on the saved asset, including basic information, and additional meta data.  The structure of the <a class="source-link" href="https://github.com/travetto/travetto/tree/master/module/asset/src/types.ts" target="_blank" null><code class="inline">Asset</code></a> looks like:</p>
<app-section-header headerType="code">Asset Structure</app-section-header>
<pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Asset</span> <span class="token punctuation">{{ '{' }}</span>
  stream<span class="token operator">:</span> <span class="token type">NodeJS</span><span class="token punctuation">.</span><span class="token type">ReadableStream</span><span class="token punctuation">;</span> <span class="token comment">// <span class="token type">This</span> will not be provided on the request for information only</span>
  size<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// <span class="token type">Path</span> in remote service</span>
  contentType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    metadata<span class="token operator">:</span> <span class="token punctuation">{{ '{' }}</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    hash<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    createdDate<span class="token operator">:</span> <span class="token type">Date</span><span class="token punctuation">;</span>
    tags<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// <span class="token type">Tags</span> for defining additional information on the asset</span>
  <span class="token punctuation">{{ '}' }}</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ '}' }}</span></code></pre><p>To get the asset information, you would call:</p>
<app-section-header headerType="code">Fetching Asset Info</app-section-header>
<pre><code class="language-typescript"><span class="token keyword">async</span> <span class="token function">checkImageGroup</span><span class="token punctuation">(</span><span class="token parameter">userId<span class="token operator">:</span><span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>asset<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>profileImage<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// <span class="token type">Check</span> asset's tags for a specific group</span>
  <span class="token keyword">return</span> info<span class="token punctuation">.</span>metadata<span class="token operator">?.</span>tags<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></div>

      <app-asset-mongo></app-asset-mongo>

      <app-asset-s3></app-asset-s3>

      <app-asset-rest></app-asset-rest>
