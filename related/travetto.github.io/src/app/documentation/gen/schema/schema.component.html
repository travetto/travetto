<!-- This file was generated by &#64;travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/schema/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Schema
<small>Data type registry for runtime validation, reflection and binding.</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install &#64;travetto/schema
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> &#64;travetto/schema

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> &#64;travetto/schema</code></pre>
  </figure>

This module's purpose is to allow for proper declaration and validation of data types, in the course of running a program.  The framework defined here, is leveraged in the <a class="module-link" routerLink="/docs/config" title="Configuration support">Configuration</a>, <a class="module-link" routerLink="/docs/cli" title="CLI infrastructure for Travetto framework">Command Line Interface</a>, <a class="module-link" routerLink="/docs/web" title="Declarative support for creating Web Applications">Web API</a>, <a class="module-link" routerLink="/docs/openapi" title="OpenAPI integration support for the Travetto framework">OpenAPI Specification</a> and <a class="module-link" routerLink="/docs/model" title="Datastore abstraction for core operations.">Data Modeling Support</a> modules.  The schema is the backbone of all data transfer, as it helps to provide validation on correctness of input, whether it is a web request, command line inputs, or a configuration file. <br><br>
This module provides a mechanism for registering classes and field level information as well the ability to apply that information at runtime.
<h2 id="registration">Registration</h2>

The registry's schema information is defined by <a target="_blank" class="external-link" href="https://typescriptlang.org">Typescript</a> AST and only applies to classes registered with the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/schema.ts#L19">&#64;Schema</a> decoration.
<h3 id="classes">Classes</h3>

The module utilizes AST transformations to collect schema information, and facilitate the registration process without user intervention. The class can also be described using providing a:
<ul> <li><code class="item input">title</code> - definition of the schema</li>
<li><code class="item input">description</code> - detailed description of the schema</li>
<li><code class="item input">examples</code> - A set of examples as <a target="_blank" class="external-link" href="https://www.json.org">JSON</a> or <a target="_blank" class="external-link" href="https://en.wikipedia.org/wiki/YAML">YAML</a></li>
</ul>
The <code class="item input">title</code> will be picked up from the <a target="_blank" class="external-link" href="http://usejsdoc.org/about-getting-started.html">JSDoc</a> comments, and additionally all fields can be set using the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/common.ts#L12">&#64;Describe</a> decorator.

  <figure class="code">
    <figcaption class="code">Sample User Schema
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/user.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Schema <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Schema</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{{'{'}}</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  favoriteFood<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'pizza'</span> <span class="token operator">|</span> <span class="token string">'burrito'</span> <span class="token operator">|</span> <span class="token string">'salad'</span><span class="token punctuation">;</span>
  height<span class="token operator">?</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span><span class="token builtin">number</span><span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span><span class="token string">'m'</span> <span class="token operator">|</span> <span class="token string">'ft'</span><span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

From this schema, the registry would have the following information:

  <figure class="config">
    <figcaption class="config">User schemas as a YAML file
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/user.yml">Source</a></cite>

</figcaption>
    <pre><code class="language-yaml"><span class="token key atrule">User</span><span class="token punctuation">:</span>
  <span class="token key atrule">fields</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> name
      <span class="token key atrule">type"</span><span class="token punctuation">:</span> string
      <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token punctuation">-</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> age
      <span class="token key atrule">type</span><span class="token punctuation">:</span> number
      <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token punctuation">-</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> favoriteFood
      <span class="token key atrule">type</span><span class="token punctuation">:</span> string
      <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">allowedValues</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"pizza"</span><span class="token punctuation">,</span> <span class="token string">"burrito"</span><span class="token punctuation">,</span> <span class="token string">"salad"</span> <span class="token punctuation">]</span></code></pre>
  </figure>

<h3 id="fields">Fields</h3>

This schema provides a powerful base for data binding and validation at runtime.  Additionally there may be types that cannot be detected, or some information that the programmer would like to override. Below are the supported field decorators:
<ul> <li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/field.ts#L24">&#64;Field</a> defines a field that will be serialized.</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L55">&#64;Required</a> defines a that field should be required</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L64">&#64;Enum</a> defines the allowable values that a field can have</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L90">&#64;Match</a> defines a regular expression that the field value should match</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L99">&#64;MinLength</a> enforces min length of a string</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L110">&#64;MaxLength</a> enforces max length of a string</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L99">&#64;Min</a> enforces min value for a date or a number</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L110">&#64;Max</a> enforces max value for a date or a number</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L140">&#64;Email</a> ensures string field matches basic email regex</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L148">&#64;Telephone</a> ensures string field matches basic telephone regex</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L156">&#64;Url</a> ensures string field matches basic url regex</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/common.ts#L41">&#64;Ignore</a> exclude from auto schema registration</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L172">&#64;Integer</a> ensures number passed in is only a whole number</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L179">&#64;Float</a> ensures number passed in allows fractional values</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L193">&#64;Currency</a> provides support for standard currency</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L74">&#64;Text</a> indicates that a field is expecting natural language input, not just discrete values</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L81">&#64;LongText</a> same as text, but expects longer form content</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/field.ts#L40">&#64;Readonly</a> defines a that field should not be bindable external to the class</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/field.ts#L33">&#64;Writeonly</a> defines a that field should not be exported in serialization, but that it can be bound to</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/field.ts#L48">&#64;Secret</a> marks a field as being sensitive.  This is used by certain logging activities to ensure sensitive information is not logged out.</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L201">&#64;Specifier</a> attributes additional specifiers to a field, allowing for more specification beyond just the field's type.</li>
<li><a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/input.ts#L208">&#64;DiscriminatorField</a> allows for promoting a given field as the owner of the sub type discriminator.</li>
</ul>
Additionally, schemas can be nested to form more complex data structures that are able to bound and validated. <br><br>
Just like the class, all fields can be defined with
<ul> <li><code class="item input">description</code> - detailed description of the schema</li>
<li><code class="item input">examples</code> - A set of examples as <a target="_blank" class="external-link" href="https://www.json.org">JSON</a> or <a target="_blank" class="external-link" href="https://en.wikipedia.org/wiki/YAML">YAML</a></li>
</ul>
And similarly, the <code class="item input">description</code> will be picked up from the <a target="_blank" class="external-link" href="http://usejsdoc.org/about-getting-started.html">JSDoc</a> comments, and additionally all fields can be set using the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/common.ts#L12">&#64;Describe</a> decorator.

<h3 id="parameters">Parameters</h3>

Parameters are available in certain scenarios (e.g. <a class="module-link" routerLink="/docs/web" title="Declarative support for creating Web Applications">Web API</a> endpoints and <a class="module-link" routerLink="/docs/cli" title="CLI infrastructure for Travetto framework">Command Line Interface</a> main methods).  In these scenarios, all of the field decorators are valid, but need to be called slightly differently to pass the typechecker. The simple solution is to use the <code class="item field">Arg</code> field of the decorator to convince Typescript its the correct type.

  <figure class="code">
    <figcaption class="code">Sample Parameter Usage
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/param-usage.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Match<span class="token punctuation">,</span> Min <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">NAME_REGEX</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[A-Z][a-z]+(\s+[A-Z][a-z]+)*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ParamUsage</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token function">main</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Match</span></span><span class="token punctuation">(</span><span class="token constant">NAME_REGEX</span><span class="token punctuation">)</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Min</span></span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Valid name and age!'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> name<span class="token punctuation">,</span> age <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="binding-validation">Binding/Validation</h2>

At runtime, once a schema is registered, a programmer can utilize this structure to perform specific operations. Specifically binding and validation.
<h3 id="binding">Binding</h3>

Binding is a very simple operation, as it takes in a class registered as as <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/decorator/schema.ts#L19">&#64;Schema</a> and a JS object that will be the source of the binding. Given the schema:

  <figure class="code">
    <figcaption class="code">Sub Schemas via Address
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/person.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Schema<span class="token punctuation">,</span> Integer <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Schema</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{{'{'}}</span>
  street1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  street2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Schema</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{{'{'}}</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Integer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  address<span class="token operator">:</span> Address<span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

A binding operation could look like:

  <figure class="code">
    <figcaption class="code">Binding from JSON to Schema
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/person-binding.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Person <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./person.ts'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Person <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">return</span> Person<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span>
    name<span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">19.999978</span><span class="token punctuation">,</span>
    address<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
      street1<span class="token operator">:</span> <span class="token string">'1234 Fun'</span><span class="token punctuation">,</span>
      street2<span class="token operator">:</span> <span class="token string">'Unit 20'</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

and the output would be a <code class="item input">Person</code> instance with the following structure

  <figure class="terminal">
    <figcaption class="terminal">Sample data output after binding

</figcaption>
    <pre><code class="language-bash">$ trv main doc/person-output.ts

Person <span class="token punctuation">{{'{'}}</span>
  name: <span class="token string">'Test'</span>,
  age: <span class="token number">19</span>,
  address: Address <span class="token punctuation">{{'{'}}</span> street1: <span class="token string">'1234 Fun'</span>, street2: <span class="token string">'Unit 20'</span> <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<p class="note"><strong>Note</strong> Binding will attempt to convert/coerce types as much as possible to honor the pattern of Javascript and it's dynamic nature.</p>

<h3 id="validation">Validation</h3>

Validation is very similar to binding, but instead of attempting to assign values, any mismatch or violation of the schema will result in errors. All errors will be collected and returned. Given the same schema as above,

  <figure class="code">
    <figcaption class="code">Sub Schemas via Address
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/person.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Schema<span class="token punctuation">,</span> Integer <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Schema</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{{'{'}}</span>
  street1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  street2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Schema</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{{'{'}}</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Integer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  address<span class="token operator">:</span> Address<span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

But now with an invalid json object

  <figure class="code">
    <figcaption class="code">Read Person, and validate
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/person-binding-invalid.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> SchemaValidator <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Person <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./person.ts'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>

  <span class="token keyword">const</span> person <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span>
    name<span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
    address<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
      street1<span class="token operator">:</span> <span class="token string">'1234 Fun'</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> SchemaValidator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span> person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

would produce an exception similar to following structure

  <figure class="terminal">
    <figcaption class="terminal">Sample error output

</figcaption>
    <pre><code class="language-bash">$ trv main doc/person-invalid-output.ts

Validation Failed <span class="token punctuation">{{'{'}}</span>
  <span class="token string">"<span class="token variable">$trv</span>"</span><span class="token builtin class-name">:</span> <span class="token string">"runtime"</span>,
  <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"Validation errors have occurred"</span>,
  <span class="token string">"category"</span><span class="token builtin class-name">:</span> <span class="token string">"data"</span>,
  <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ValidationResultError"</span>,
  <span class="token string">"at"</span><span class="token builtin class-name">:</span> <span class="token string">"2029-03-14T04:00:00.618Z"</span>,
  <span class="token string">"details"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token string">"errors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{{'{'}}</span>
        <span class="token string">"kind"</span><span class="token builtin class-name">:</span> <span class="token string">"type"</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"number"</span>,
        <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"age is not a valid number"</span>,
        <span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"age"</span>
      <span class="token punctuation">{{'}'}}</span>,
      <span class="token punctuation">{{'{'}}</span>
        <span class="token string">"kind"</span><span class="token builtin class-name">:</span> <span class="token string">"required"</span>,
        <span class="token string">"active"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"address.street2 is required"</span>,
        <span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"address.street2"</span>
      <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h3 id="custom-validators">Custom Validators</h3>

Within the schema framework, it is possible to add custom validators class level.  This allows for more flexibility when dealing with specific situations (e.g. password requirements or ensuring two fields match)

  <figure class="code">
    <figcaption class="code">Password Validator
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/password-validator.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Schema<span class="token punctuation">,</span> Validator<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">ValidationError</span> <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> passwordValidator <span class="token operator">=</span> <span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span><span class="token operator">:</span> ValidationError <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=></span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">const</span> password <span class="token operator">=</span> user<span class="token punctuation">.</span>password<span class="token punctuation">;</span>
  <span class="token keyword">const</span> hasNumber <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> hasSpecial <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[!&#64;#$%%^&amp;*()&lt;>?/,.;':"']</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> noRepeat <span class="token operator">=</span> <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(.)(\1)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasNumber <span class="token operator">||</span> <span class="token operator">!</span>hasSpecial <span class="token operator">||</span> <span class="token operator">!</span>noRepeat<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{{'{'}}</span>
      kind<span class="token operator">:</span> <span class="token string">'password-rules'</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> <span class="token string">'password'</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token string">'A password must include at least one number, one special char, and have no repeating characters'</span>
    <span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Schema</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Validator</span></span><span class="token punctuation">(</span>passwordValidator<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{{'{'}}</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

When the validator is executed, it has access to the entire object, and you can check any of the values.  The validator expects an object of a specific structure if you are looking to indicate an error has occurred.

  <figure class="code">
    <figcaption class="code">Validation Error Structure
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/src/validate/types.ts#L10">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ValidationError</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token comment">/**
   * The error message
   */</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * The object path of the error
   */</span>
  path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * The kind of validation
   */</span>
  kind<span class="token operator">:</span> ValidationKind<span class="token punctuation">;</span>
  <span class="token comment">/**
   * The value provided
   */</span>
  value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Regular expression to match
   */</span>
  regex<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Number to compare against
   */</span>
  limit<span class="token operator">?</span><span class="token operator">:</span> NumericLikeIntrinsic<span class="token punctuation">;</span>
  <span class="token comment">/**
   * The type of the field
   */</span>
  type<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Source of the error
   */</span>
  source<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="custom-types">Custom Types</h2>

When working with the schema, the basic types are easily understood, but some of <a target="_blank" class="external-link" href="https://typescriptlang.org">Typescript</a>'s more complex constructs are too complex to automate cleanly. <br><br>
To that end, the module supports two concepts:
<h3 id="type-adapters">Type Adapters</h3>

This feature is meant to allow for simple Typescript types to be able to be backed by a proper class.  This is because all of the typescript type information disappears at runtime, and so only concrete types (like classes) remain.  An example of this, can be found with how the <a class="module-link" routerLink="/docs/model-query" title="Datastore abstraction for advanced query support.">Data Model Querying</a> module handles geo data.

  <figure class="code">
    <figcaption class="code">Point Contract
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/src/types.ts#L3">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token comment">/**
 * Geometric Point as [number,number] with validation and binding support
 *
 * &#64;concrete ./internal/types.ts#PointContract
 */</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">Point</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
  </figure>

  <figure class="code">
    <figcaption class="code">Point Implementation
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/src/internal/types.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> DataUtil <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'../data.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> SchemaTypeUtil <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'../type-config.ts'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> InvalidSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Convert to tuple of two numbers
 */</span>
<span class="token keyword">function</span> <span class="token function">bindPoint</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">typeof</span> InvalidSymbol <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> input<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>value <span class="token operator">=></span> DataUtil<span class="token punctuation">.</span><span class="token function">coerceType</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> Number<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span> <span class="token keyword">else</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> InvalidSymbol<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span>

<span class="token comment">/**
 * Validate we have an actual point
 */</span>
<span class="token keyword">function</span> <span class="token function">validatePoint</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token string">'type'</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">const</span> bound <span class="token operator">=</span> <span class="token function">bindPoint</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bound <span class="token operator">!==</span> InvalidSymbol <span class="token operator">&amp;&amp;</span> bound <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>bound<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>bound<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token string">'type'</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span>

<span class="token comment">/**
 * Point Contract
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PointContract</span> <span class="token punctuation">{{'{'}}</span> <span class="token punctuation">{{'}'}}</span>

SchemaTypeUtil<span class="token punctuation">.</span><span class="token function">setSchemaTypeConfig</span><span class="token punctuation">(</span>PointContract<span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span>
  validate<span class="token operator">:</span> validatePoint<span class="token punctuation">,</span>
  bind<span class="token operator">:</span> bindPoint<span class="token punctuation">,</span>
<span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>PointContract<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> value<span class="token operator">:</span> <span class="token string">'Point'</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
  </figure>

What you can see here is that the <code class="item input">Point</code> type is now backed by a class that supports:
<ul> <li><code class="item method">validateSchema</code> - Will run during validation for this specific type.</li>
<li><code class="item method">bindSchema</code> - Will run during binding to ensure correct behavior.</li>
</ul>

  <figure class="code">
    <figcaption class="code">Simple Custom Type Usage
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/schema/doc/custom-type-usage.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Schema<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">Point</span> <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Schema</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LocationAware</span> <span class="token punctuation">{{'{'}}</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  point<span class="token operator">:</span> Point<span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

All that happens now, is the type is exported, and the class above is able to properly handle point as an <code class="item input">[x, y]</code> tuple.  All standard binding and validation patterns are supported, and type enforcement will work as expected.

  <figure class="terminal">
    <figcaption class="terminal">Custom Type Validation

</figcaption>
    <pre><code class="language-bash">$ trv main doc/custom-type-output.ts

Validation Failed <span class="token punctuation">{{'{'}}</span>
  <span class="token string">"<span class="token variable">$trv</span>"</span><span class="token builtin class-name">:</span> <span class="token string">"runtime"</span>,
  <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"Validation errors have occurred"</span>,
  <span class="token string">"category"</span><span class="token builtin class-name">:</span> <span class="token string">"data"</span>,
  <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ValidationResultError"</span>,
  <span class="token string">"at"</span><span class="token builtin class-name">:</span> <span class="token string">"2029-03-14T04:00:00.837Z"</span>,
  <span class="token string">"details"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token string">"errors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{{'{'}}</span>
        <span class="token string">"kind"</span><span class="token builtin class-name">:</span> <span class="token string">"type"</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"Point"</span>,
        <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"point is not a valid Point"</span>,
        <span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"point"</span>
      <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="data-utilities">Data Utilities</h2>

Data utilities for binding values, and type conversion. Currently <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/schema/src/data.ts#L11">DataUtil</a> includes:
<ul> <li><code class="item method">deepAssign(a, b, mode ?)</code> which allows for deep assignment of <code class="item input">b</code> onto <code class="item input">a</code>, the <code class="item input">mode</code> determines how aggressive the assignment is, and how flexible it is.  <code class="item input">mode</code> can have any of the following values:
<ul> <li><code class="item input">loose</code>, which is the default is the most lenient. It will not error out, and overwrites will always happen</li>
<li><code class="item input">coerce</code>, will attempt to force values from <code class="item input">b</code> to fit the types of <code class="item input">a</code>, and if it can't it will error out</li>
<li><code class="item input">strict</code>, will error out if the types do not match</li>
</ul>
</li>
<li><code class="item method">coerceType(input: unknown, type: Class&lt;unknown&gt;, strict = true)</code> which allows for converting an input type into a specified <code class="item input">type</code> instance, or throw an error if the types are incompatible.</li>
<li><code class="item method">shallowClone&lt;T = unknown&gt;(a: T): T</code> will shallowly clone a field</li>
<li><code class="item method">filterByKeys&lt;T&gt;(input: T, exclude: (string | RegExp)[]): T</code> will filter a given object, and return a plain object (if applicable) with fields excluded using the values in the <code class="item input">exclude</code> input</li>
</ul>
