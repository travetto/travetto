<!-- This file was generated by &#64;travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/auth-rest-jwt/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Rest Auth JWT
<small>Rest authentication JWT integration support for the Travetto framework</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install &#64;travetto/auth-rest-jwt
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> &#64;travetto/auth-rest-jwt

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> &#64;travetto/auth-rest-jwt</code></pre>
  </figure>

One of <a class="module-link" routerLink="/docs/auth-rest" title="Rest authentication integration support for the Travetto framework">Rest Auth</a>'s main responsibilities is being able to send and receive authentication/authorization information from the client.  This data can be encoded in many different forms, and this module provides the ability to encode into and decode from <a target="_blank" class="external-link" href="https://jwt.io/">JWT</a> s. This module fulfills the contract required by <a class="module-link" routerLink="/docs/auth-rest" title="Rest authentication integration support for the Travetto framework">Rest Auth</a> of being able to encode and decode a user principal, by leveraging <a class="module-link" routerLink="/docs/jwt" title="JSON Web Token implementation">JWT</a>'s token generation features. <br><br>
The token can be encoded as a cookie or as a header depending on configuration.  Additionally, the encoding process allows for auto-renewing of the token if that is desired.  When encoding as a cookie, this becomes a seamless experience, and can be understood as a light-weight session. <br><br>
The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-rest-jwt/src/codec.ts#L12">JWTPrincipalCodec</a> is exposed as a tool for allowing for converting an authenticated principal into a JWT, and back again.

  <figure class="code">
    <figcaption class="code">JWTPrincipalCodec
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth-rest-jwt/src/codec.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> AuthContext<span class="token punctuation">,</span> Principal <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/auth'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> PrincipalCodec<span class="token punctuation">,</span> RestAuthConfig <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/auth-rest'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Inject<span class="token punctuation">,</span> Injectable <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/di'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> FilterContext <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/rest'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> RestJWTConfig <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./config'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Principal codec via JWT
 */</span>
<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JWTPrincipalCodec</span> <span class="token keyword">implements</span> <span class="token class-name">PrincipalCodec</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  config<span class="token operator">:</span> RestJWTConfig<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  restConfig<span class="token operator">:</span> RestAuthConfig<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  authContext<span class="token operator">:</span> AuthContext<span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">decode</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> FilterContext<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Principal <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>restConfig<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">readValue</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">const</span> out <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>signer<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>out<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>authContext<span class="token punctuation">.</span>authToken <span class="token operator">=</span> <span class="token punctuation">{{'{'}}</span> type<span class="token operator">:</span> <span class="token string">'jwt'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> token <span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>
      <span class="token punctuation">{{'}'}}</span>
      <span class="token keyword">return</span> out<span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token keyword">async</span> <span class="token function">encode</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> FilterContext<span class="token punctuation">,</span> data<span class="token operator">:</span> Principal <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> data <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>signer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>restConfig<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">writeValue</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>res<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

As you can see, the encode token just creates a <a target="_blank" class="external-link" href="https://jwt.io/">JWT</a> based on the principal provided, and decoding verifies the token, and returns the principal.
