<!-- This file was generated by &#64;travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/web-http/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Web HTTP Server Support
<small>Web HTTP Server Support</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install &#64;travetto/web-http
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> &#64;travetto/web-http

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> &#64;travetto/web-http</code></pre>
  </figure>

This module provides basic for running <a target="_blank" class="external-link" href="https://nodejs.org/api/http.html">http</a>. <a target="_blank" class="external-link" href="https://nodejs.org/api/https.html">https</a>  and <a target="_blank" class="external-link" href="https://nodejs.org/api/http2.html">http2</a> servers, along with support for tls key generation during development.
<h2 id="running-a-server">Running a Server</h2>

By default, the framework provides a default <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/cli/src/registry/decorator.ts#L98">&#64;CliCommand</a> for <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web-http/src/types.ts#L19">WebHttpServer</a> that will follow default behaviors, and spin up the server.

  <figure class="terminal">
    <figcaption class="terminal">Standard application

</figcaption>
    <pre><code class="language-bash">$ trv web:http

Initialized <span class="token punctuation">{{'{'}}</span>
  manifest: <span class="token punctuation">{{'{'}}</span>
    main: <span class="token punctuation">{{'{'}}</span>
      name: <span class="token string">'&#64;travetto-doc/web-http'</span>,
      folder: <span class="token string">'./doc-exec'</span>
    <span class="token punctuation">{{'}'}}</span>,
    workspace: <span class="token punctuation">{{'{'}}</span>
      name: <span class="token string">'&#64;travetto-doc/web-http'</span>,
      path: <span class="token string">'./doc-exec'</span>,
      mono: false,
      manager: <span class="token string">'npm'</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>,
  runtime: <span class="token punctuation">{{'{'}}</span>
    production: false,
    role: <span class="token string">'doc'</span>,
    debug: false,
    resourcePaths: <span class="token punctuation">[</span>
      <span class="token string">'./doc-exec/resources'</span>
    <span class="token punctuation">]</span>,
    profiles: <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">{{'}'}}</span>,
  config: <span class="token punctuation">{{'{'}}</span>
    sources: <span class="token punctuation">[</span> <span class="token punctuation">{{'{'}}</span> priority: <span class="token number">999</span>, source: <span class="token string">'memory://override'</span> <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">]</span>,
    active: <span class="token punctuation">{{'{'}}</span>
      AcceptConfig: <span class="token punctuation">{{'{'}}</span> applies: false, types: <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span>,
      CacheControlConfig: <span class="token punctuation">{{'{'}}</span> applies: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>,
      CompressConfig: <span class="token punctuation">{{'{'}}</span>
        applies: true,
        supportedEncodings: <span class="token punctuation">[</span> <span class="token string">'br'</span>, <span class="token string">'gzip'</span>, <span class="token string">'identity'</span>, <span class="token string">'deflate'</span> <span class="token punctuation">]</span>
      <span class="token punctuation">{{'}'}}</span>,
      CookieConfig: <span class="token punctuation">{{'{'}}</span> applies: true, httponly: true, sameSite: <span class="token string">'lax'</span>, path: <span class="token string">'/'</span> <span class="token punctuation">{{'}'}}</span>,
      CorsConfig: <span class="token punctuation">{{'{'}}</span> applies: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>,
      DecompressConfig: <span class="token punctuation">{{'{'}}</span>
        applies: true,
        supportedEncodings: <span class="token punctuation">[</span> <span class="token string">'br'</span>, <span class="token string">'gzip'</span>, <span class="token string">'deflate'</span>, <span class="token string">'identity'</span> <span class="token punctuation">]</span>
      <span class="token punctuation">{{'}'}}</span>,
      EtagConfig: <span class="token punctuation">{{'{'}}</span> applies: true, minimumSize: <span class="token string">'10kb'</span> <span class="token punctuation">{{'}'}}</span>,
      TrustProxyConfig: <span class="token punctuation">{{'{'}}</span> applies: true, ips: <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span>,
      WebBodyConfig: <span class="token punctuation">{{'{'}}</span>
        applies: true,
        limit: <span class="token string">'1mb'</span>,
        parsingTypes: <span class="token punctuation">{{'{'}}</span>
          text: <span class="token string">'text'</span>,
          <span class="token string">'application/json'</span><span class="token builtin class-name">:</span> <span class="token string">'json'</span>,
          <span class="token string">'application/x-www-form-urlencoded'</span><span class="token builtin class-name">:</span> <span class="token string">'form'</span>
        <span class="token punctuation">{{'}'}}</span>
      <span class="token punctuation">{{'}'}}</span>,
      WebConfig: <span class="token punctuation">{{'{'}}</span> defaultMessage: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>,
      WebHttpConfig: <span class="token punctuation">{{'{'}}</span>
        httpVersion: <span class="token string">'1.1'</span>,
        port: <span class="token number">3000</span>,
        bindAddress: <span class="token string">'0.0.0.0'</span>,
        tls: <span class="token boolean">false</span>
      <span class="token punctuation">{{'}'}}</span>,
      WebLogConfig: <span class="token punctuation">{{'{'}}</span> applies: true, showStackTrace: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span>
Listening on port <span class="token punctuation">{{'{'}}</span> port: <span class="token number">3000</span> <span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h3 id="configuration">Configuration</h3>

  <figure class="code">
    <figcaption class="code">Standard Web Http Config
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/web-http/src/config.ts#L13">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WebHttpConfig</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token comment">/**
   * What version of HTTP to use
   * Version 2 requires SSL for direct browser access
   */</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">EnvVar</span></span><span class="token punctuation">(</span><span class="token string">'WEB_HTTP_VERSION'</span><span class="token punctuation">)</span>
  httpVersion<span class="token operator">:</span> <span class="token string">'1.1'</span> <span class="token operator">|</span> <span class="token string">'2'</span> <span class="token operator">=</span> <span class="token string">'1.1'</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * The port to run on
   */</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">EnvVar</span></span><span class="token punctuation">(</span><span class="token string">'WEB_HTTP_PORT'</span><span class="token punctuation">)</span>
  port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * The bind address, defaults to 0.0.0.0
   */</span>
  bindAddress<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * Is TLS active
   */</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">EnvVar</span></span><span class="token punctuation">(</span><span class="token string">'WEB_HTTP_TLS'</span><span class="token punctuation">)</span>
  tls<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * TLS Keys
   */</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Secret</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  tlsKeys<span class="token operator">?</span><span class="token operator">:</span> WebSecureKeyPair<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Ignore</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  fetchUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">postConstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tls <span class="token operator">??=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>httpVersion <span class="token operator">===</span> <span class="token string">'2'</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token keyword">await</span> NetUtil<span class="token punctuation">.</span><span class="token function">getFreePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bindAddress <span class="token operator">||=</span> NetUtil<span class="token punctuation">.</span><span class="token function">getLocalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>tls<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token comment">// Clear out keys if tls is not set</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Runtime<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AppError</span><span class="token punctuation">(</span><span class="token string">'Default tls keys are only valid for development use, please specify a config value at web.tls.keys'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">{{'}'}}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys <span class="token operator">=</span> <span class="token keyword">await</span> WebTlsUtil<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span> <span class="token keyword">else</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys<span class="token punctuation">.</span>key<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span> <span class="token comment">// We have files or resources</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys<span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token keyword">await</span> RuntimeResources<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys<span class="token punctuation">.</span>cert <span class="token operator">=</span> <span class="token keyword">await</span> RuntimeResources<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tlsKeys<span class="token punctuation">.</span>cert<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">{{'}'}}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>fetchUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span><span class="token keyword">this</span><span class="token punctuation">.</span>tls <span class="token operator">?</span> <span class="token string">'https'</span> <span class="token operator">:</span> <span class="token string">'http'</span><span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span><span class="token keyword">this</span><span class="token punctuation">.</span>bindAddress<span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span><span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h3 id="creating-a-custom-cli-entry-point">Creating a Custom CLI Entry Point</h3>

To customize a Web server, you may need to construct an entry point using the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/cli/src/registry/decorator.ts#L98">&#64;CliCommand</a> decorator. This could look like:

  <figure class="code">
    <figcaption class="code">Application entry point for Web Applications
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/web-http/doc/cli.web_custom.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Env<span class="token punctuation">,</span> toConcrete <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/runtime'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> CliCommand <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/cli'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> DependencyRegistryIndex <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/di'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Registry <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/registry'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> <span class="token keyword">type</span> <span class="token class-name">WebHttpServer</span><span class="token punctuation">,</span> WebHttpConfig <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/web-http'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'./config-override.ts'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">CliCommand</span></span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> runTarget<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SampleApp</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token function">preMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{{'{'}}</span>
    Env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'production'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token keyword">async</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CUSTOM STARTUP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> Registry<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> DependencyRegistryIndex<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>WebHttpConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>tls <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// Configure server before running</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">await</span> DependencyRegistryIndex<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">toConcrete</span><span class="token generic class-name"><span class="token operator">&lt;</span>WebHttpServer<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{{'{'}}</span> complete <span class="token punctuation">{{'}'}}</span> <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> complete<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

And using the pattern established in the <a class="module-link" routerLink="/docs/cli" title="CLI infrastructure for Travetto framework">Command Line Interface</a> module, you would run your program using <code class="item command">npx trv web:custom</code>.

  <figure class="terminal">
    <figcaption class="terminal">Custom application

</figcaption>
    <pre><code class="language-bash">$ trv web:custom

CUSTOM STARTUP
Initialized <span class="token punctuation">{{'{'}}</span>
  manifest: <span class="token punctuation">{{'{'}}</span>
    main: <span class="token punctuation">{{'{'}}</span>
      name: <span class="token string">'&#64;travetto-doc/web-http'</span>,
      folder: <span class="token string">'./doc-exec'</span>
    <span class="token punctuation">{{'}'}}</span>,
    workspace: <span class="token punctuation">{{'{'}}</span>
      name: <span class="token string">'&#64;travetto-doc/web-http'</span>,
      path: <span class="token string">'./doc-exec'</span>,
      mono: false,
      manager: <span class="token string">'npm'</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>,
  runtime: <span class="token punctuation">{{'{'}}</span>
    production: true,
    role: <span class="token string">'std'</span>,
    debug: false,
    resourcePaths: <span class="token punctuation">[</span>
      <span class="token string">'./doc-exec/resources'</span>
    <span class="token punctuation">]</span>,
    profiles: <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">{{'}'}}</span>,
  config: <span class="token punctuation">{{'{'}}</span>
    sources: <span class="token punctuation">[</span>
      <span class="token punctuation">{{'{'}}</span> priority: <span class="token number">10</span>, source: <span class="token string">'direct'</span> <span class="token punctuation">{{'}'}}</span>,
      <span class="token punctuation">{{'{'}}</span> priority: <span class="token number">999</span>, source: <span class="token string">'memory://override'</span> <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">]</span>,
    active: <span class="token punctuation">{{'{'}}</span>
      AcceptConfig: <span class="token punctuation">{{'{'}}</span> applies: false, types: <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span>,
      CacheControlConfig: <span class="token punctuation">{{'{'}}</span> applies: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>,
      CompressConfig: <span class="token punctuation">{{'{'}}</span>
        applies: true,
        supportedEncodings: <span class="token punctuation">[</span> <span class="token string">'br'</span>, <span class="token string">'gzip'</span>, <span class="token string">'identity'</span>, <span class="token string">'deflate'</span> <span class="token punctuation">]</span>
      <span class="token punctuation">{{'}'}}</span>,
      CookieConfig: <span class="token punctuation">{{'{'}}</span> applies: true, httponly: true, sameSite: <span class="token string">'lax'</span>, path: <span class="token string">'/'</span> <span class="token punctuation">{{'}'}}</span>,
      CorsConfig: <span class="token punctuation">{{'{'}}</span> applies: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>,
      DecompressConfig: <span class="token punctuation">{{'{'}}</span>
        applies: true,
        supportedEncodings: <span class="token punctuation">[</span> <span class="token string">'br'</span>, <span class="token string">'gzip'</span>, <span class="token string">'deflate'</span>, <span class="token string">'identity'</span> <span class="token punctuation">]</span>
      <span class="token punctuation">{{'}'}}</span>,
      EtagConfig: <span class="token punctuation">{{'{'}}</span> applies: true, minimumSize: <span class="token string">'10kb'</span> <span class="token punctuation">{{'}'}}</span>,
      TrustProxyConfig: <span class="token punctuation">{{'{'}}</span> applies: true, ips: <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span>,
      WebBodyConfig: <span class="token punctuation">{{'{'}}</span>
        applies: true,
        limit: <span class="token string">'1mb'</span>,
        parsingTypes: <span class="token punctuation">{{'{'}}</span>
          text: <span class="token string">'text'</span>,
          <span class="token string">'application/json'</span><span class="token builtin class-name">:</span> <span class="token string">'json'</span>,
          <span class="token string">'application/x-www-form-urlencoded'</span><span class="token builtin class-name">:</span> <span class="token string">'form'</span>
        <span class="token punctuation">{{'}'}}</span>
      <span class="token punctuation">{{'}'}}</span>,
      WebConfig: <span class="token punctuation">{{'{'}}</span> defaultMessage: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>,
      WebHttpConfig: <span class="token punctuation">{{'{'}}</span>
        httpVersion: <span class="token string">'1.1'</span>,
        port: <span class="token number">3000</span>,
        bindAddress: <span class="token string">'0.0.0.0'</span>,
        tls: <span class="token boolean">true</span>
      <span class="token punctuation">{{'}'}}</span>,
      WebLogConfig: <span class="token punctuation">{{'{'}}</span> applies: true, showStackTrace: <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span>
Listening on port <span class="token punctuation">{{'{'}}</span> port: <span class="token number">3000</span> <span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="node-web-http-server">Node Web Http Server</h2>

  <figure class="code">
    <figcaption class="code">Implementation
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/web-http/src/node.ts#L13">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">NodeWebHttpServer</span> <span class="token keyword">implements</span> <span class="token class-name">WebHttpServer</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  serverConfig<span class="token operator">:</span> WebHttpConfig<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  router<span class="token operator">:</span> StandardWebRouter<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  configService<span class="token operator">:</span> ConfigurationService<span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>WebServerHandle<span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token keyword">await</span> WebHttpUtil<span class="token punctuation">.</span><span class="token function">startHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>serverConfig<span class="token punctuation">,</span> dispatcher<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">,</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Initialized'</span><span class="token punctuation">,</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configService<span class="token punctuation">.</span><span class="token function">initBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Listening'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> port<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serverConfig<span class="token punctuation">.</span>port <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handle<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

Current the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web-http/src/node.ts#L13">NodeWebHttpServer</a> is the only provided <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web-http/src/types.ts#L19">WebHttpServer</a> implementation.  It supports http/1.1, http/2, and tls, and is the same foundation as used by express, koa, and other popular frameworks.

<h2 id="standard-utilities">Standard Utilities</h2>

The module also provides standard utilities for starting http servers programmatically:

  <figure class="code">
    <figcaption class="code">Web Http Utilities
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/web-http/src/http.ts#L26">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WebHttpUtil</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token comment">/**
   * Build a simple request handler
   * &#64;param dispatcher
   */</span>
  <span class="token keyword">static</span> <span class="token function">buildHandler</span><span class="token punctuation">(</span>dispatcher<span class="token operator">:</span> WebDispatcher<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> HttpRequest<span class="token punctuation">,</span> response<span class="token operator">:</span> HttpResponse<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Start an http server
   */</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">startHttpServer</span><span class="token punctuation">(</span>config<span class="token operator">:</span> WebHttpServerConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>WebServerHandle<span class="token operator">&lt;</span>HttpServer<span class="token operator">>></span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Create a WebRequest given an incoming http request
   */</span>
  <span class="token keyword">static</span> <span class="token function">toWebRequest</span><span class="token punctuation">(</span>request<span class="token operator">:</span> HttpRequest<span class="token punctuation">)</span><span class="token operator">:</span> WebRequest<span class="token punctuation">;</span>
  <span class="token comment">/**
   * Send WebResponse to outbound http response
   */</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">respondToServerResponse</span><span class="token punctuation">(</span>webResponse<span class="token operator">:</span> WebResponse<span class="token punctuation">,</span> response<span class="token operator">:</span> HttpResponse<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

Specifically, looking at <code class="item method">buildHandler</code>,

  <figure class="code">
    <figcaption class="code">Web Http Utilities
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/web-http/src/http.ts#L32">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">static</span> <span class="token function">buildHandler</span><span class="token punctuation">(</span>dispatcher<span class="token operator">:</span> WebDispatcher<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> HttpRequest<span class="token punctuation">,</span> response<span class="token operator">:</span> HttpResponse<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> HttpRequest<span class="token punctuation">,</span> response<span class="token operator">:</span> HttpResponse<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> webRequest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toWebRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> webResponse <span class="token operator">=</span> <span class="token keyword">await</span> dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> request<span class="token operator">:</span> webRequest <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">respondToServerResponse</span><span class="token punctuation">(</span>webResponse<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

we can see the structure for integrating the server behavior with the <a class="module-link" routerLink="/docs/web" title="Declarative support for creating Web Applications">Web API</a> module dispatcher:
<ul> <li>Converting the node primitive request to a  <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web/src/types/request.ts#L11">WebRequest</a></li>
<li>Dispatching the request through the framework</li>
<li>Receiving the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web/src/types/response.ts#L3">WebResponse</a> and sending that back over the primitive response.</li>
</ul>

<h2 id="tls-support">TLS Support</h2>

Additionally the framework supports TLS out of the box, by allowing you to specify your public and private keys for the cert.  In dev mode, the framework will also automatically generate a self-signed cert if:
<ul> <li>TLS support is configured</li>
<li><a target="_blank" class="external-link" href="https://www.npmjs.com/package/node-forge">node-forge</a> is installed</li>
<li>Not running in production</li>
<li>No keys provided</li>
</ul>
This is useful for local development where you implicitly trust the cert. <br><br>
TLS support can be enabled by setting <code class="item input">web.http.tls: true</code> in your config. The key/cert can be specified as string directly in the config file/environment variables.  The key/cert can also be specified as a path to be picked up by <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/resources.ts#L8">RuntimeResources</a>.
