<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/email-compiler/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Email Compilation Support
<small>Email compiling module</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install @travetto/email-compiler
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/email-compiler

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> @travetto/email-compiler</code></pre>
  </figure>

This is primarily a set of command line tools for compiling and developing templates.  The inputs are compiled files, generally under the <code class="item path">support/</code> folder, that represents the necessary input for the email compilation.  <a class="module-link" routerLink="/docs/email-inky" title="Email Inky templating module">Email Inky Templates</a> shows this pattern by leveraging <a target="_blank" class="external-link" href="https://en.wikipedia.org/wiki/JSX_(JavaScript)">JSX</a> bindings for the <a target="_blank" class="external-link" href="https://github.com/zurb/inky">inky</a> framework, allowing for compile-time checked templates.
<h2 id="asset-management">Asset Management</h2>

The templating process involves loading various assets (html, css, images), and so there is provision for asset management and loading.  The templating config allows for specifying asset paths, with the following paths (in order of precedence):
<ol> <li><code class="item path">%ROOT%/resources/email</code></li>
<li><code class="item path">@travetto/email-{{'{'}}engine{{'}'}}/resources/email</code></li>
</ol>
When looking up a resources, every asset folder is consulted, in order, and the first to resolve an asset wins.  This allows for overriding of default templating resources, as needed.  The compilation process will convert <code class="item path">.email.html</code> files into <code class="item path">.compiled.html</code>, <code class="item path">.compiled.text</code> and <code class="item path">.compiled.subject</code> suffixes to generate the outputs respectively.

<h2 id="template-extension">Template Extension</h2>

The template extension points are defined at:
<ol> <li><code class="item path">email/main.scss</code> - The entry point for adding, and overriding any <a target="_blank" class="external-link" href="https://github.com/sass/dart-sass">sass</a></li>
<li><code class="item path">email/{{'{'}}engine{{'}'}}.wrapper.html</code> - The html wrapper for the specific templating engine implementation.</li>
</ol>

<h2 id="template-compilation">Template Compilation</h2>

The general process is as follows:
<ol> <li>Load in the email template.</li>
<li>Resolve any associated stylings for said template.</li>
<li>Optimize styles against provided html, removing all unused stylings</li>
<li>Render template into html, text, and subject outputs.</li>
<li>Inline and optimize all images for html email transmission.</li>
</ol>

<h2 id="images">Images</h2>

When referencing an image from the <code class="item path">resources</code> folder in a template, e.g.

  <figure class="code">
    <figcaption class="code">Sample Image Reference
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/email-compiler/doc/email/sample-image.html">Source</a></cite>

</figcaption>
    <pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/email/logo.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
  </figure>

The image will be extracted out and embedded in the email as a multi part message.  This allows for compression and optimization of images as well as externalizing resources that may not be immediately public.  The currently supported set of image types are:
<ul> <li>jpeg</li>
<li>png</li>
</ul>

<h2 id="template-development">Template Development</h2>

The module provides <a class="module-link" routerLink="/docs/cli" title="CLI infrastructure for Travetto framework">Command Line Interface</a> and <a target="_blank" class="external-link" href="https://marketplace.visualstudio.com/items?itemName=arcsine.travetto-plugin">VSCode plugin</a> support for email template development.

<h2 id="cli-compilation">CLI Compilation</h2>

The module provides <a class="module-link" routerLink="/docs/cli" title="CLI infrastructure for Travetto framework">Command Line Interface</a> support for email template compilation also. Running

  <figure class="terminal">
    <figcaption class="terminal">Running template compilation

</figcaption>
    <pre><code class="language-bash">$ trv email:compile <span class="token parameter variable">-h</span>

Usage: email:compile <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

Options:
  -w, <span class="token parameter variable">--watch</span>  Compile <span class="token keyword">in</span> <span class="token function">watch</span> mode
  -h, <span class="token parameter variable">--help</span>   display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span></code></pre>
  </figure>

Will convert all <code class="item path">.email.html</code> files into the appropriate <code class="item path">.compiled.html</code>, <code class="item path">.compiled.text</code> and <code class="item path">.compiled.subject</code> files.  These will be used during the running of the application.  By default these files are added to the <code class="item path">.gitignore</code> as they are generally not intended to be saved but to be generated during the build process.

<h2 id="vscode-plugin">VSCode Plugin</h2>

In addition to command line tools, the <a target="_blank" class="external-link" href="https://marketplace.visualstudio.com/items?itemName=arcsine.travetto-plugin">VSCode plugin</a> also supports:
<ul> <li>automatic compilation on change</li>
<li>real-time rendering of changes visually</li>
<li>ability to send test emails during development</li>
<li>ability to define custom context for template rendering</li>
</ul>
