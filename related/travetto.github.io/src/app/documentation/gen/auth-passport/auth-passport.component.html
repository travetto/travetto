<!-- This file was generated by the framweork and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/master/module/auth-passport/DOCS.js and execute "npm run docs" to rebuild -->
<div class="documentation">
<h1>Passport Auth
          <small>Passport authentication integration support for the travetto framework</small>

        </h1>

      <figure class="install">
      <figcaption class="install">Install @travetto/auth-passport
      
      </figcaption>
      <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/auth-passport</code></pre>     
      </figure>

Within the node ecosystem, the most prevalent auth framework is <a target="_blank" class="external-link" href="http://passportjs.org">passport</a>.  With countless integrations, the desire to leverage as much of it as possible, is extremely high. To that end, this module provides support for <a target="_blank" class="external-link" href="http://passportjs.org">passport</a> baked in. Registering and configuring a <a target="_blank" class="external-link" href="http://passportjs.org">passport</a> strategy is fairly straightforward.

      <figure class="code">
      <figcaption class="code">Sample Facebook/passport config
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/auth-passport/alt/e2e/src/conf.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Strategy <span class="token keyword">as</span> FacebookStrategy <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'passport-facebook'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> InjectableFactory <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/di'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> PrincipalSource<span class="token punctuation">,</span> Identity <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> IdentitySource <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth-rest'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> PassportIdentitySource <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth-passport'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">FbUser</span> <span class="token punctuation">{{'{'}}</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  roles<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">FB_AUTH</span> <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token string">'auth_facebook'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{{'{'}}</span>
  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token constant">FB_AUTH</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">facebookPassport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> IdentitySource <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PassportIdentitySource</span><span class="token punctuation">(</span><span class="token string">'facebook'</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">FacebookStrategy</span><span class="token punctuation">(</span>
        <span class="token punctuation">{{'{'}}</span>
          clientID<span class="token operator">:</span> <span class="token string">'&lt;appId>'</span><span class="token punctuation">,</span>
          clientSecret<span class="token operator">:</span> <span class="token string">'&lt;appSecret>'</span><span class="token punctuation">,</span>
          callbackURL<span class="token operator">:</span> <span class="token string">'http://localhost:3000/auth/facebook/callback'</span><span class="token punctuation">,</span>
          profileFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'displayName'</span><span class="token punctuation">,</span> <span class="token string">'photos'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">accessToken<span class="token punctuation">,</span> refreshToken<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span>
          <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">user<span class="token operator">:</span> FbUser</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span>
        id<span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
        permissions<span class="token operator">:</span> user<span class="token punctuation">.</span>roles<span class="token punctuation">,</span>
        details<span class="token operator">:</span> user
      <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">principalSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> PrincipalSource <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token keyword">extends</span> <span class="token class-name">PrincipalSource</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">async</span> <span class="token function">resolvePrincipal</span><span class="token punctuation">(</span><span class="token parameter">ident<span class="token operator">:</span> Identity</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token keyword">return</span> ident<span class="token punctuation">;</span>
      <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">{{'}'}}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>     
      </figure>

As you can see, <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/master/module/auth-passport/src/identity.ts#L14">PassportIdentitySource</a> will take care of the majority of the work, and all that is required is:
<ul> <li>Provide the name of the strategy (should be unique)</li>
 <li>Provide the strategy instance. <p class="note"><strong>Note</strong> you will need to provide the callback for the strategy to ensure you pass the external principal back into the framework</p></li>
 <li>The conversion functions which defines the mapping between external and local identities.</li></ul>

After that, the provider is no different than any other, and can be used accordingly.  Additionally, because <a target="_blank" class="external-link" href="http://passportjs.org">passport</a> runs first, in it's entirety, you can 
use the provider as you normally would any <a target="_blank" class="external-link" href="http://passportjs.org">passport</a> middleware.

      <figure class="code">
      <figcaption class="code">Sample routes using Facebook/passport provider
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/auth-passport/alt/e2e/src/simple.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Redirect<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Request <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/rest'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Authenticate<span class="token punctuation">,</span> Authenticated<span class="token punctuation">,</span> Unauthenticated <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth-rest'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> <span class="token constant">FB_AUTH</span> <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./conf'</span><span class="token punctuation">;</span>

@<span class="token meta">Controller</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SampleAuth</span> <span class="token punctuation">{{'{'}}</span>

  @<span class="token meta">Get</span><span class="token punctuation">(</span><span class="token string">'/name'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{{'{'}}</span> name<span class="token operator">:</span> <span class="token string">'bob'</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  @<span class="token meta">Get</span><span class="token punctuation">(</span><span class="token string">'/facebook'</span><span class="token punctuation">)</span>
  @<span class="token meta">Authenticate</span><span class="token punctuation">(</span><span class="token constant">FB_AUTH</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">fbLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token punctuation">{{'}'}}</span>

  @<span class="token meta">Get</span><span class="token punctuation">(</span><span class="token string">'/self'</span><span class="token punctuation">)</span>
  @<span class="token meta">Authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Request</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> req<span class="token punctuation">.</span>auth<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  @<span class="token meta">Get</span><span class="token punctuation">(</span><span class="token string">'/facebook/callback'</span><span class="token punctuation">)</span>
  @<span class="token meta">Authenticate</span><span class="token punctuation">(</span><span class="token constant">FB_AUTH</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">fbLoginComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Redirect</span><span class="token punctuation">(</span><span class="token string">'/auth/self'</span><span class="token punctuation">,</span> <span class="token number">301</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  @<span class="token meta">Post</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
  @<span class="token meta">Unauthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Request</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">await</span> req<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token comment">/**
   * Simple Echo
   */</span>
  @<span class="token meta">Post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">echo</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">>></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>     
      </figure>

</div>