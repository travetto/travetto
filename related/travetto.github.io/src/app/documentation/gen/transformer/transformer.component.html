<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/transformer/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Transformation
<small>Functionality for AST transformations, with transformer registration, and general utils</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install @travetto/transformer
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/transformer

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> @travetto/transformer</code></pre>
  </figure>

This module provides support for enhanced AST transformations, and declarative transformer registration, with common patterns to support all the transformers used throughout the framework. Transformations are located by <code class="item path">support/transformer.&lt;name&gt;.ts</code> as the filename. <br><br>
The module is primarily aimed at extremely advanced usages for things that cannot be detected at runtime.  The <a class="module-link" routerLink="/docs/registry" title="Patterns and utilities for handling registration of metadata and functionality for run-time use">Registry</a> module already has knowledge of all <code class="item input">class</code>es and <code class="item input">field</code>s, and is able to listen to changes there.  Many of the modules build upon work by some of the foundational transformers defined in <a class="module-link" routerLink="/docs/manifest" title="Support for project indexing, manifesting, along with file watching">Manifest</a>, <a class="module-link" routerLink="/docs/registry" title="Patterns and utilities for handling registration of metadata and functionality for run-time use">Registry</a>, <a class="module-link" routerLink="/docs/schema" title="Data type registry for runtime validation, reflection and binding.">Schema</a> and <a class="module-link" routerLink="/docs/di" title="Dependency registration/management and injection support.">Dependency Injection</a>.  These all center around defining a registry of classes, and associated type information. <br><br>
Because working with the <a target="_blank" class="external-link" href="https://typescriptlang.org">Typescript</a> API can be delicate (and open to breaking changes), creating new transformers should be done cautiously.
<h2 id="monorepos-and-idempotency">Monorepos and Idempotency</h2>

Within the framework, any build or compile step will target the entire workspace, and for mono-repo projects, will include all modules.  The optimization this provides is great, but comes with a strict requirement that all compilation processes need to be idempotent.  This means that compiling a module directly, versus as a dependency should always produce the same output. This produces a requirement that all transformers are opt-in by the source code, and which transformers are needed in a file should be code-evident.  This also means that no transformers are optional, as that could produce different output depending on the dependency graph for a given module.

<h2 id="custom-transformer">Custom Transformer</h2>

Below is an example of a transformer that upper cases all <code class="item input">class</code>, <code class="item input">method</code> and <code class="item input">param</code> declarations.  This will break any code that depends upon it as we are redefining all the identifiers at compile time.

  <figure class="code">
    <figcaption class="code">Sample Transformer - Upper case all declarations
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/transformer/doc/transformer.upper.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> ts <span class="token keyword">from</span> <span class="token string">'typescript'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> OnProperty<span class="token punctuation">,</span> TransformerState<span class="token punctuation">,</span> OnMethod<span class="token punctuation">,</span> OnClass <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/transformer'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MakeUpper</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">OnProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">handleProperty</span><span class="token punctuation">(</span>state<span class="token operator">:</span> TransformerState<span class="token punctuation">,</span> node<span class="token operator">:</span> ts<span class="token punctuation">.</span>PropertyDeclaration<span class="token punctuation">)</span><span class="token operator">:</span> ts<span class="token punctuation">.</span>PropertyDeclaration <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>importName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'@travetto/transformer/doc/upper'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">return</span> node<span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>factory<span class="token punctuation">.</span><span class="token function">updatePropertyDeclaration</span><span class="token punctuation">(</span>
      node<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>modifiers<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>initializer <span class="token operator">??</span> state<span class="token punctuation">.</span><span class="token function">createIdentifier</span><span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">OnClass</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">handleClass</span><span class="token punctuation">(</span>state<span class="token operator">:</span> TransformerState<span class="token punctuation">,</span> node<span class="token operator">:</span> ts<span class="token punctuation">.</span>ClassDeclaration<span class="token punctuation">)</span><span class="token operator">:</span> ts<span class="token punctuation">.</span>ClassDeclaration <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>importName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'@travetto/transformer/doc/upper'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">return</span> node<span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>factory<span class="token punctuation">.</span><span class="token function">updateClassDeclaration</span><span class="token punctuation">(</span>
      node<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>modifiers<span class="token punctuation">,</span>
      state<span class="token punctuation">.</span><span class="token function">createIdentifier</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>name<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>typeParameters<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>heritageClauses<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>members
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">OnMethod</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">handleMethod</span><span class="token punctuation">(</span>state<span class="token operator">:</span> TransformerState<span class="token punctuation">,</span> node<span class="token operator">:</span> ts<span class="token punctuation">.</span>MethodDeclaration<span class="token punctuation">)</span><span class="token operator">:</span> ts<span class="token punctuation">.</span>MethodDeclaration <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>importName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'@travetto/transformer/doc/upper'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">return</span> node<span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>factory<span class="token punctuation">.</span><span class="token function">updateMethodDeclaration</span><span class="token punctuation">(</span>
      node<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>modifiers<span class="token punctuation">,</span>
      <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      state<span class="token punctuation">.</span><span class="token function">createIdentifier</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>typeParameters<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>parameters<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
      node<span class="token punctuation">.</span>body
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<p class="note"><strong>Note</strong> This should be a strong indicator that it is very easy to break code in unexpected ways.</p>

  <figure class="code">
    <figcaption class="code">Sample Input
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/transformer/doc/upper.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{{'{'}}</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  dob<span class="token operator">:</span> Date<span class="token punctuation">;</span>

  <span class="token function">computeAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dob<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

  <figure class="code">
    <figcaption class="code">Sample Output

</figcaption>
    <pre><code class="language-javascript"><span class="token string">"use strict"</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token constant">TEST</span> <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tslib_1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"tslib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Ⲑ_root_index_1 <span class="token operator">=</span> tslib_1<span class="token punctuation">.</span><span class="token function">__importStar</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@travetto/manifest/src/root-index.js"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Ⲑ_decorator_1 <span class="token operator">=</span> tslib_1<span class="token punctuation">.</span><span class="token function">__importStar</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@travetto/registry/src/decorator.js"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ᚕf <span class="token operator">=</span> <span class="token string">"@travetto/transformer/doc/upper.js"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">TEST</span> <span class="token operator">=</span> exports<span class="token punctuation">.</span><span class="token constant">TEST</span> <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">TEST</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">static</span> Ⲑinit <span class="token operator">=</span> Ⲑ_root_index_1<span class="token punctuation">.</span>RootIndex<span class="token punctuation">.</span><span class="token function">registerFunction</span><span class="token punctuation">(</span><span class="token constant">TEST</span><span class="token punctuation">,</span> ᚕf<span class="token punctuation">,</span> <span class="token number">649563175</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> <span class="token constant">COMPUTEAGE</span><span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token number">1286718349</span> <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">NAME</span><span class="token punctuation">;</span>
    <span class="token constant">AGE</span><span class="token punctuation">;</span>
    <span class="token constant">DOB</span><span class="token punctuation">;</span>
    <span class="token constant">COMPUTEAGE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'AGE'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">DOB</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token constant">TEST</span> <span class="token operator">=</span> <span class="token constant">TEST</span> <span class="token operator">=</span> tslib_1<span class="token punctuation">.</span><span class="token function">__decorate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    Ⲑ_decorator_1<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
  </figure>
