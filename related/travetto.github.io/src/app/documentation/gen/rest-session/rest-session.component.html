<!-- This file was generated by &#64;travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/rest-session/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>REST Session
<small>Session provider for the travetto rest module.</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install &#64;travetto/rest-session
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> &#64;travetto/rest-session

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> &#64;travetto/rest-session</code></pre>
  </figure>

This is a module that adds session support to the <a class="module-link" routerLink="/docs/rest" title="Declarative api for RESTful APIs with support for the dependency injection module.">RESTful API</a> framework.  Sessions allow for persistent data across multiple requests.  Within the framework the sessions are stored against any <a class="module-link" routerLink="/docs/model" title="Datastore abstraction for core operations.">Data Modeling Support</a> implementation that provides <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/model/src/service/expiry.ts">ModelExpirySupport</a>, as the data needs to be able to be expired appropriately.  The list of supported model providers are:
<ul> <li><a class="module-link" routerLink="/docs/model" title="Datastore abstraction for core operations.">Data Modeling Support</a>'s <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/model/src/provider/file.ts#L50">FileModelService</a> and <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/model/src/provider/memory.ts#L53">MemoryModelService</a></li>
<li><a class="module-link" routerLink="/docs/model-redis" title="Redis backing for the travetto model module.">Redis Model Support</a></li>
<li><a class="module-link" routerLink="/docs/model-mongo" title="Mongo backing for the travetto model module.">MongoDB Model Support</a></li>
<li><a class="module-link" routerLink="/docs/model-s3" title="S3 backing for the travetto model module.">S3 Model Support</a></li>
<li><a class="module-link" routerLink="/docs/model-dynamodb" title="DynamoDB backing for the travetto model module.">DynamoDB Model Support</a></li>
<li><a class="module-link" routerLink="/docs/model-elasticsearch" title="Elasticsearch backing for the travetto model module, with real-time modeling support for Elasticsearch mappings.">Elasticsearch Model Source</a></li>
</ul>
A session allows for defining the expiration time, what state the session should be in, as well as the payload (session data).  The session and session data are accessible via the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/rest/src/decorator/param.ts#L38">&#64;Context</a> parameter as <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/rest-session/src/session.ts#L18">Session</a> and <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/rest-session/src/session.ts#L8">SessionData</a> respectively.  Iit can also be accessed via the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/rest-session/src/typings.d.ts#L7">TravettoRequest</a> as a session property.

  <figure class="code">
    <figcaption class="code">Sample Session Usage
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/rest-session/doc/usage.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> InjectableFactory <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/di'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> MemoryModelService<span class="token punctuation">,</span> ModelExpirySupport <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/model'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Controller<span class="token punctuation">,</span> Put<span class="token punctuation">,</span> Get <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/rest'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> SessionData<span class="token punctuation">,</span> Session<span class="token punctuation">,</span> SessionModelⲐ <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/rest-session'</span><span class="token punctuation">;</span>

<span class="token comment">// Applies to entire execution, not just this file</span>
<span class="token keyword">class</span> <span class="token class-name">SessionConfig</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token comment">/**
   * Session provider must be specified. The memory service is sufficient for simple
   *   workloads, buts falls down when dealing with multiple servers
   */</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">InjectableFactory</span></span><span class="token punctuation">(</span>SessionModelⲐ<span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">getSessionModel</span><span class="token punctuation">(</span>memory<span class="token operator">:</span> MemoryModelService<span class="token punctuation">)</span><span class="token operator">:</span> ModelExpirySupport <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> memory<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span>

<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'/session'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SessionRoutes</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Put</span></span><span class="token punctuation">(</span><span class="token string">'/info'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">storeInfo</span><span class="token punctuation">(</span>data<span class="token operator">:</span> SessionData<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    data<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Roger'</span><span class="token punctuation">;</span> <span class="token comment">// Setting data</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">logout</span><span class="token punctuation">(</span>session<span class="token operator">:</span> Session<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">await</span> session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'/info/age'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getInfo</span><span class="token punctuation">(</span>data<span class="token operator">:</span> SessionData<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> data<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

This usage should be comparable to <a target="_blank" class="external-link" href="https://expressjs.com">express</a>, <a target="_blank" class="external-link" href="https://koajs.com/">koa</a> and mostly every other framework.
<h2 id="session-configuration">Session Configuration</h2>

The module supports a general set of configuration that should cover the majority of session behaviors:

  <figure class="code">
    <figcaption class="code">Session Config
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/rest-session/src/config.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> AppError<span class="token punctuation">,</span> Runtime <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/base'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Config <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Secret <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'&#64;travetto/schema'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Rest session config
 */</span>
<span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Config</span></span><span class="token punctuation">(</span><span class="token string">'rest.session'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SessionConfig</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token comment">/**
   * Should the session auto write
   */</span>
  autoCommit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Max age for a given session
   */</span>
  maxAge <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// Half hour</span>
  <span class="token comment">/**
   * Can the session be renewed
   */</span>
  renew <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Should the session support rolling renewals
   */</span>
  rolling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Should the session be signed
   */</span>
  sign <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Secret for signing the session
   */</span>
  <span class="token decorator"><span class="token at operator">&#64;</span><span class="token function">Secret</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  secret<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Signature key name
   */</span>
  keyName <span class="token operator">=</span> <span class="token string">'trv_sid'</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Location for auth
   */</span>
  transport<span class="token operator">:</span> <span class="token string">'cookie'</span> <span class="token operator">|</span> <span class="token string">'header'</span> <span class="token operator">=</span> <span class="token string">'cookie'</span><span class="token punctuation">;</span>

  <span class="token function">postConstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>secret <span class="token operator">&amp;&amp;</span> Runtime<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AppError</span><span class="token punctuation">(</span><span class="token string">'Default session secret is only valid for development use, please specify a config value at rest.session.secret'</span><span class="token punctuation">,</span> <span class="token string">'permissions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

These are all configurable via the <code class="item input">rest.session.*</code> config values.  And as a note, in production, a secret is required to be specified.
