<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/master/module/rest-koa/doc.ts and execute "npx trv doc" to rebuild -->
<div class="documentation">
<h1>Koa REST Source
          <small>Koa provider for the travetto rest module.</small>

        </h1>

      <figure class="install">
      <figcaption class="install">Install @travetto/rest-koa
      
      </figcaption>
      <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/rest-koa</code></pre>     
      </figure>

The module is an <a target="_blank" class="external-link" href="https://koajs.com/">koa</a> provider for the <a class="module-link" routerLink="/docs/rest" title="Declarative api for RESTful APIs with support for the dependency injection module.">RESTful API</a> module.  This module provides an implementation of <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/master/module/rest/src/application/rest.ts#L23">RestApplication</a> for automatic injection in the default Rest server.

<h2 id="customizing-rest-app">Customizing Rest App</h2>

      <figure class="code">
      <figcaption class="code">Customizing the Koa App
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/rest-koa/doc/customize.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Middleware <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'koa'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Injectable <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/di'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> KoaRestServer <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/rest-koa'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">let</span> <span class="token function-variable function">rateLimit</span><span class="token operator">:</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> windowMs<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span> <span class="token operator">=></span> Middleware<span class="token punctuation">;</span>

@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> primary<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">CustomRestServer</span> <span class="token keyword">extends</span> <span class="token class-name">KoaRestServer</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> limiter <span class="token operator">=</span> <span class="token function">rateLimit</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span>
      windowMs<span class="token operator">:</span> <span class="token number">15</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 15 minutes</span>
      max<span class="token operator">:</span> <span class="token number">100</span> <span class="token comment">// limit each IP to 100 requests per windowMs</span>
    <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//  apply to all requests</span>
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>limiter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> app<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>     
      </figure>

<h2 id="default-middleware">Default Middleware</h2>
When working with an <a target="_blank" class="external-link" href="https://koajs.com/">koa</a> applications, the module provides what is assumed to be a sufficient set of basic filters. Specifically:

      <figure class="code">
      <figcaption class="code">Configured Middleware
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/rest-koa/src/server.ts#L56">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">kCompress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">kCustomBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>     
      </figure>

<h2 id="extension-aws-lambda">Extension - AWS Lambda</h2>
The <a target="_blank" class="external-link" href="https://koajs.com/">koa</a> module supports integration with <a target="_blank" class="external-link" href="https://github.com/awslabs/aws-serverless-express/blob/master/README.md">aws-serverless-express</a> when installed.  This produces an instance of <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/master/module/rest/src/application/rest.ts#L23">RestApplication</a> that is able to integrate with AWS appropriately.
</div>
