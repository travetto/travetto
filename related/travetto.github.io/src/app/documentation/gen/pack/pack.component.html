<!-- This file was generated by the framweork and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/master/module/pack/doc.ts and execute "npm run docs" to rebuild -->
<div class="documentation">
<h1>Pack
          <small>Code packing utilities</small>

        </h1>

      <figure class="install">
      <figcaption class="install">Install @travetto/pack
      
      </figcaption>
      <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/pack</code></pre>     
      </figure>

<h2 id="cli-pack">CLI - pack</h2> 

      <figure class="terminal">
      <figcaption class="terminal">Pack usage
      
      </figcaption>
      <pre><code class="language-bash">$ trv pack --help

Usage:  pack <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>mode<span class="token punctuation">]</span>

Options:
  -w --workspace <span class="token punctuation">[</span>workspace<span class="token punctuation">]</span>  Workspace directory <span class="token punctuation">(</span>default: <span class="token string">"/tmp/pack_travetto_pack"</span><span class="token punctuation">)</span>
  -h, --help                  display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span>

Available Pack Modes:
  * default <span class="token punctuation">[</span>support/pack.config.ts<span class="token punctuation">]</span>
  * rest/aws-lambda <span class="token punctuation">[</span>@travetto/rest/support/pack.aws-lambda.ts<span class="token punctuation">]</span>
  * rest/docker <span class="token punctuation">[</span>@travetto/rest/support/pack.docker.ts<span class="token punctuation">]</span></code></pre>     
      </figure>

This command line operation will compile your project, and produce a ready to use workspace as a deliverable. The pack operation is actually a wrapper around multiple sub-operations that are run in series to produce the desired final structure for deployment.  The currently support operations are:

<ul> <li>assemble</li>
 <li>zip</li>
 <li>docker</li></ul>

<h3 id="cli-pack-assemble">CLI - pack:assemble</h3>

Assemble is the operation that stages the project's code for deployment.  The assembly process goes through the following operations:

<ol> <li>Cleaning Workspace - Cleans workspace to start with an empty workspace</li>
 <li>Copying Dependencies - Computes the prod depedencies and copies them into the new workspace</li>
 <li>Copying App Content - Copies over application content (src/resources/support/bin)</li>
 <li>Excluding Pre-Compile Files - Any files that should be excluded pre-compilation, are removed</li>
 <li>Compiling - Compiles the code in the new workspace, isolating it from your local development</li>
 <li>Excluding Post-Compile Files - Removes any files that should be excluded, post compilation</li>
 <li>Copying Added Content - Adds in any additional content that is not in the standard locations</li>
 <li>Removing Empty Folders - Purge all empty folders, recursively</li>
 <li>Writng Env.js - Write out the .env.js file with computed any env vars that should be set for the deployed app</li>
 <li>Remove Source Maps - If keep source is false, all source maps are purged from your app's code</li>
 <li>Emptying .ts Files - If keep source is false, all .ts files are emptied, as compilation will not occur at runtime</li></ol>

      <figure class="code">
      <figcaption class="code">Assemble Default Config
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/pack/support/pack.config.ts#L5">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript">assemble<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
  active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  cacheDir<span class="token operator">:</span> <span class="token string">'cache'</span><span class="token punctuation">,</span>
  keepSource<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">readonly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  add<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{{'{'}}</span> <span class="token string">'node_modules/@travetto/cli/bin/trv.js'</span><span class="token operator">:</span> <span class="token string">'node_modules/.bin/trv'</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{{'{'}}</span> <span class="token string">'node_modules/lodash/lodash.min.js'</span><span class="token operator">:</span> <span class="token string">'node_modules/lodash/lodash.js'</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  excludeCompile<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'node_modules/@travetto/*/alt/'</span><span class="token punctuation">,</span>
    <span class="token string">'node_modules/@travetto/*/test/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'bower.json'</span><span class="token punctuation">,</span>
    <span class="token string">'LICENSE'</span><span class="token punctuation">,</span>
    <span class="token string">'LICENCE'</span><span class="token punctuation">,</span>
    <span class="token string">'*.map'</span><span class="token punctuation">,</span>
    <span class="token string">'*.md'</span><span class="token punctuation">,</span>
    <span class="token string">'*.lock'</span><span class="token punctuation">,</span>
    <span class="token string">'*.html'</span><span class="token punctuation">,</span>
    <span class="token string">'*.mjs'</span><span class="token punctuation">,</span>
    <span class="token string">'*.ts'</span><span class="token punctuation">,</span>
    <span class="token string">'*.d.ts'</span><span class="token punctuation">,</span></code></pre>     
      </figure>

      <figure class="terminal">
      <figcaption class="terminal">Assemble Usage
      
      </figcaption>
      <pre><code class="language-bash">$ trv pack:assemble --help

Usage:  pack:assemble <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>mode<span class="token punctuation">]</span>

Options:
  -w --workspace <span class="token punctuation">[</span>workspace<span class="token punctuation">]</span>  Workspace directory <span class="token punctuation">(</span>default: <span class="token string">"/tmp/pack_travetto_pack"</span><span class="token punctuation">)</span>
  -k --keep-source <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span>  Should <span class="token builtin class-name">source</span> be preserved <span class="token punctuation">(</span>default: <span class="token boolean">true</span><span class="token punctuation">)</span>
  -r --readonly <span class="token punctuation">[</span>boolean<span class="token punctuation">]</span>     Build a <span class="token builtin class-name">readonly</span> deployable <span class="token punctuation">(</span>default: <span class="token boolean">true</span><span class="token punctuation">)</span>
  -h, --help                  display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span>

Available Pack Modes:
  * default <span class="token punctuation">[</span>support/pack.config.ts<span class="token punctuation">]</span>
  * rest/aws-lambda <span class="token punctuation">[</span>@travetto/rest/support/pack.aws-lambda.ts<span class="token punctuation">]</span>
  * rest/docker <span class="token punctuation">[</span>@travetto/rest/support/pack.docker.ts<span class="token punctuation">]</span></code></pre>     
      </figure>

<h3 id="cli-pack-zip">CLI - pack:zip</h3>

Zip is an optional step, that can run post assembly.  The only configuration it currently provides is the ability to specify the output location for the zip file.

      <figure class="code">
      <figcaption class="code">Zip Default Config
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/pack/support/pack.config.ts#L51">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript">zip<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
  active<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token string">'output.zip'</span>
<span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span></code></pre>     
      </figure>

      <figure class="terminal">
      <figcaption class="terminal">Zip Usage
      
      </figcaption>
      <pre><code class="language-bash">$ trv pack:zip --help

Usage:  pack:zip <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>mode<span class="token punctuation">]</span>

Options:
  -w --workspace <span class="token punctuation">[</span>workspace<span class="token punctuation">]</span>  Workspace directory <span class="token punctuation">(</span>default: <span class="token string">"/tmp/pack_travetto_pack"</span><span class="token punctuation">)</span>
  -o --output <span class="token punctuation">[</span>output<span class="token punctuation">]</span>        Output File <span class="token punctuation">(</span>default: <span class="token string">"output.zip"</span><span class="token punctuation">)</span>
  -h, --help                  display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span>

Available Pack Modes:
  * default <span class="token punctuation">[</span>support/pack.config.ts<span class="token punctuation">]</span>
  * rest/aws-lambda <span class="token punctuation">[</span>@travetto/rest/support/pack.aws-lambda.ts<span class="token punctuation">]</span>
  * rest/docker <span class="token punctuation">[</span>@travetto/rest/support/pack.docker.ts<span class="token punctuation">]</span></code></pre>     
      </figure>

<h3 id="modes">Modes</h3>
Various modules may provide customizations to the default <code class="item path">pack.config.ts</code> to allow for easy integration with the packing process.  A simple example of this is via the <a class="module-link" href="https://github.com/travetto/travetto/tree/master/module/rest" title="Declarative api for RESTful APIs with support for the dependency injection module.">RESTful API</a> module, for how to publish lambda packages.

      <figure class="code">
      <figcaption class="code">Rest, pack.lambda.ts
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/rest/support/pack.aws-lambda.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> AppCache<span class="token punctuation">,</span> FsUtil <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/boot'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> AllConfigPartial <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/pack/bin/operation/pack'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> config<span class="token operator">:</span> AllConfigPartial <span class="token operator">=</span> <span class="token punctuation">{{'{'}}</span>
  name<span class="token operator">:</span> <span class="token string">'rest/aws-lambda'</span><span class="token punctuation">,</span>
  assemble<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
    active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    keepSource<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'node_modules/node-forge'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    env<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token constant">NO_COLOR</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span>
    postProcess<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{{'{'}}</span>
      <span class="token punctuation">[</span><span class="token string">'Install Entrypoint'</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>cfg<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> cacheDir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> workspace<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{{'{'}}</span>
        <span class="token keyword">const</span> Entrypoint <span class="token operator">=</span> AppCache<span class="token punctuation">.</span><span class="token function">toEntryName</span><span class="token punctuation">(</span><span class="token keyword">require</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@travetto/rest/support/entry.aws-lambda.ts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>AppCache<span class="token punctuation">.</span>cacheDir<span class="token punctuation">,</span> FsUtil<span class="token punctuation">.</span><span class="token function">resolveUnix</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>workspace<span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>cacheDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>Entrypoint<span class="token punctuation">,</span> FsUtil<span class="token punctuation">.</span><span class="token function">resolveUnix</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>workspace<span class="token punctuation">,</span> <span class="token string">'index.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">{{'}'}}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span>
  zip<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
    active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token string">'dist/lambda.zip'</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span></code></pre>     
      </figure>

      <figure class="terminal">
      <figcaption class="terminal">Invoking Pack with Mode
      
      </figcaption>
      <pre><code class="language-bash">npx trv pack <span class="token operator">&lt;</span>mode<span class="token operator">></span></code></pre>     
      </figure>

<h3 id="configuration">Configuration</h3>

By default, the configuration consists of two components.
* The default config in <code class="item path">support/pack.config.ts</code> and
* The config selected to execute from the cli

These two configurations will be loaded and layered, with the selected config taking precedence.

      <figure class="code">
      <figcaption class="code">Example pack.config.ts
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/pack/doc/support/pack.config.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> AllConfigPartial <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/pack/bin/operation/pack'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> config<span class="token operator">:</span> AllConfigPartial <span class="token operator">=</span> <span class="token punctuation">{{'{'}}</span>
  workspace<span class="token operator">:</span> <span class="token string">'dist/alt'</span><span class="token punctuation">,</span>
  assemble<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
    active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    add<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{{'{'}}</span> assets<span class="token operator">:</span> <span class="token string">'assets'</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{{'{'}}</span> <span class="token string">'/secret/location/key.pem'</span><span class="token operator">:</span> <span class="token string">'resources/key.pem'</span> <span class="token punctuation">{{'}'}}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span>
  zip<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
    active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token string">'dist/build.zip'</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span></code></pre>     
      </figure>
</div>
