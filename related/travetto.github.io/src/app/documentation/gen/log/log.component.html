<!-- This file was generated by the framweork and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/master/module/log/doc.ts and execute "npm run docs" to rebuild -->
<div class="documentation">
<h1>Logging
          <small>Logging framework that integrates at the console.log level.</small>

        </h1>

      <figure class="install">
      <figcaption class="install">Install @travetto/log
      
      </figcaption>
      <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/log</code></pre>     
      </figure>

This module provides logging functionality, building upon <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/master/module/base/src/console.ts">ConsoleManager</a> in the <a class="module-link" href="https://github.com/travetto/travetto/tree/master/module/base" title="Application phase management, environment config and common utilities for travetto applications.">Base</a> module.  This is all ultimately built upon <a target="_blank" class="external-link" href="https://nodejs.org/api/console.html">console</a> operations. 

The supported operations are:
<ul> <li><code class="item method">console.error</code> which logs at the <code class="item input">ERROR</code> level</li>
 <li><code class="item method">console.warn</code> which logs at the <code class="item input">WARN</code> level</li>
 <li><code class="item method">console.info</code> which logs at the <code class="item input">INFO</code> level</li>
 <li><code class="item method">console.debug</code> which logs at the <code class="item input">DEBUG</code> level</li>
 <li><code class="item method">console.log</code> which logs at the <code class="item input">INFO</code> level</li></ul>

<p class="note"><strong>Note</strong> All other console methods are excluded, specifically <code class="item method">trace</code>, <code class="item method">inspect</code>, <code class="item method">dir</code>, <code class="item method">time</code>/<code class="item method">timeEnd</code></p>

<h2 id="filtering-debug">Filtering Debug</h2>

The <code class="item input">debug</code> messages can be filtered using the patterns from the <a target="_blank" class="external-link" href="https://www.npmjs.com/package/debug">debug</a>.  You can specify wild cards to only <code class="item input">DEBUG</code> specific modules, folders or files.  You can specify multiple, and you can also add negations to exclude specific packages.

      <figure class="terminal">
      <figcaption class="terminal">Sample environment flags
      
      </figcaption>
      <pre><code class="language-bash"><span class="token comment"># Debug</span>
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>@app:*,-@trv:model npx trv run app
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>-@trv:registry npx trv run app
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>@trv:rest npx trv run app
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>@trv:*,-@trv:model npx trv run app</code></pre>     
      </figure>

<p class="note"><strong>Note</strong> In production mode, all <code class="item method">console.debug</code> invocations are compiled away for performance/security reasons. This means that the code is actually removed, and will not execute.</p>

<h2 id="how-logging-is-instrumented">How Logging is Instrumented</h2>

All of the logging instrumentation occurs at transpilation time.  All <code class="item method">console.*</code> methods are replaced with a call to a globally defined variable that delegates to the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/master/module/base/src/console.ts">ConsoleManager</a>.  This module, hooks into the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/master/module/base/src/console.ts">ConsoleManager</a> and receives all logging events from all files compiled by the <a class="module-link" href="https://github.com/travetto/travetto/tree/master/module/compiler" title="Node-integration of Typescript Compiler with advanced functionality for detecting changes in classes and methods.">Compiler</a> module.

A sample of the instrumentation would be:

      <figure class="code">
      <figcaption class="code">Sample logging at various levels
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/log/doc/transpile.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Start Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Divide by zero'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> error<span class="token operator">:</span> e <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'End Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>     
      </figure>

      <figure class="code">
      <figcaption class="code">Sample After Transpilation
      
      </figcaption>
      <pre><code class="language-javascript"><span class="token string">"use strict"</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>work <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token function">ᚕlg</span><span class="token punctuation">(</span><span class="token string">"debug"</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> file<span class="token operator">:</span> <span class="token function">ᚕsrc</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> scope<span class="token operator">:</span> <span class="token string">"work"</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span> <span class="token string">'Start Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token function">ᚕlg</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> file<span class="token operator">:</span> <span class="token function">ᚕsrc</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> scope<span class="token operator">:</span> <span class="token string">"work"</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span> <span class="token string">'Divide by zero'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> error<span class="token operator">:</span> e <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token function">ᚕlg</span><span class="token punctuation">(</span><span class="token string">"debug"</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> file<span class="token operator">:</span> <span class="token function">ᚕsrc</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> scope<span class="token operator">:</span> <span class="token string">"work"</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span> <span class="token string">'End Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span>
exports<span class="token punctuation">.</span>work <span class="token operator">=</span> work<span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'ᚕtrv'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>     
      </figure>

And when in <code class="item input">prod</code> mode transforms into:

      <figure class="code">
      <figcaption class="code">Sample After Transpilation, in Prod
      
      </figcaption>
      <pre><code class="language-javascript"><span class="token string">"use strict"</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>work <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token function">ᚕlg</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> file<span class="token operator">:</span> <span class="token function">ᚕsrc</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> scope<span class="token operator">:</span> <span class="token string">"work"</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span> <span class="token string">'Divide by Zero'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> error<span class="token operator">:</span> e <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span>
exports<span class="token punctuation">.</span>work <span class="token operator">=</span> work<span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'ᚕtrv'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>     
      </figure>

<h2 id="logging-to-external-systems">Logging to External Systems</h2>
By default the logging functionality logs messages directly to the console, relying on the <code class="item method">util.inspect</code> method, as is the standard behavior.  When building distributed systems, with multiple separate logs, it is useful to rely on structured logging for common consumption.  The framework supports logging as <a target="_blank" class="external-link" href="https://www.json.org">JSON</a>, which is easily consumable by services like <a target="_blank" class="external-link" href="https://elastic.co">elasticsearch</a> or <a target="_blank" class="external-link" href="https://aws.amazon.com/cloudwatch/">AWS Cloudwatch</a> if running as a lambda or in a docker container.  

The main caveat that comes with this, is that not all objects can be converted to JSON (specifically circular dependencies, and unsupported types).  That end, the framework recommends logging with the following format, <code class="item input">message: string</code> <code class="item input">context: Record&lt;string, Primitive&gt;</code>.  Here context can be recursive, but the general idea is to only pass in known data structures that will not break the <a target="_blank" class="external-link" href="https://www.json.org">JSON</a> production.

<h2 id="sample-output">Sample Output</h2>

The logging output, as indicated provides context for location of invocation. Given the file <code class="item path">test/simple.ts</code>:

      <figure class="code">
      <figcaption class="code">Various log levels
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/master/module/log/doc/output.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Woah!'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> a<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> b<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> c<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> d<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Woah!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>     
      </figure>

The corresponding output would be

      <figure class="terminal">
      <figcaption class="terminal">Logging output
      
      </figcaption>
      <pre><code class="language-bash">$ node @travetto/base/bin/main ./doc/output.ts

<span class="token number">2021</span>-03-14T05:00:00.618Z info  <span class="token punctuation">[</span>@trv:log/doc/output:2<span class="token punctuation">]</span> Hello World
<span class="token number">2021</span>-03-14T05:00:00.837Z info  <span class="token punctuation">[</span>@trv:log/doc/output:4<span class="token punctuation">]</span> Woah<span class="token operator">!</span> <span class="token punctuation">{{'{'}}</span>
<span class="token number">2021</span>-03-14T05:00:01.510Z info  <span class="token punctuation">[</span>@trv:log/doc/output:6<span class="token punctuation">]</span> Woah<span class="token operator">!</span>
<span class="token number">2021</span>-03-14T05:00:02.450Z debug <span class="token punctuation">[</span>@trv:log/doc/output:8<span class="token punctuation">]</span> Test</code></pre>     
      </figure>
</div>
