<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/runtime/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Runtime
<small>Runtime for travetto applications.</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install @travetto/runtime
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/runtime

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> @travetto/runtime</code></pre>
  </figure>

Runtime is the foundation of all <a target="_blank" class="external-link" href="https://travetto.dev">Travetto</a> applications.  It is intended to be a minimal application set, as well as support for commonly shared functionality. It has support for the following key areas:
<ul> <li>Runtime Context</li>
<li>Environment Support</li>
<li>Standard Error Support</li>
<li>Console Management</li>
<li>Resource Access</li>
<li>Encoding and Decoding Utilities</li>
<li>Binary Utilities</li>
<li>JSON Utilities</li>
<li>Common Utilities</li>
<li>Time Utilities</li>
<li>Process Execution</li>
<li>Shutdown Management</li>
<li>Path behavior</li>
</ul>

<h2 id="runtime-context">Runtime Context</h2>

While running any code within the framework, there are common patterns/goals for interacting with the underlying code repository.  These include:
<ul> <li>Determining attributes of the running environment (e.g., name, debug information, production flags)</li>
<li>Resolving paths within the workspace (e.g. standard, tooling, resourcing, modules)</li>
</ul>

  <figure class="code">
    <figcaption class="code">Runtime Shape
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/context.ts#L13">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">$Runtime</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>idx<span class="token operator">:</span> ManifestIndex<span class="token punctuation">,</span> resourceOverrides<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/** The role we are running as */</span>
  <span class="token keyword">get</span> <span class="token function">role</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Role<span class="token punctuation">;</span>
  <span class="token comment">/** Are we in production mode */</span>
  <span class="token keyword">get</span> <span class="token function">production</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token comment">/** Are we in development mode */</span>
  <span class="token keyword">get</span> <span class="token function">localDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token comment">/** Get debug value */</span>
  <span class="token keyword">get</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Manifest main */</span>
  <span class="token keyword">get</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ManifestContext<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/** Manifest workspace */</span>
  <span class="token keyword">get</span> <span class="token function">workspace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> ManifestContext<span class="token punctuation">[</span><span class="token string">'workspace'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/** Are we running from a mono-root? */</span>
  <span class="token keyword">get</span> <span class="token function">monoRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token comment">/** Main source path */</span>
  <span class="token keyword">get</span> <span class="token function">mainSourcePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Produce a workspace relative path */</span>
  <span class="token function">workspaceRelative</span><span class="token punctuation">(</span><span class="token operator">...</span>parts<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Strip off the workspace path from a file */</span>
  <span class="token function">stripWorkspacePath</span><span class="token punctuation">(</span>full<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Produce a workspace path for tooling, with '@' being replaced by node_module/name folder */</span>
  <span class="token function">toolPath</span><span class="token punctuation">(</span><span class="token operator">...</span>parts<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Resolve single module path */</span>
  <span class="token function">modulePath</span><span class="token punctuation">(</span>modulePath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> overrides<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Resolve resource paths */</span>
  <span class="token function">resourcePaths</span><span class="token punctuation">(</span>paths<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/** Get source for function */</span>
  <span class="token function">getSourceFile</span><span class="token punctuation">(</span>handle<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Get import for function */</span>
  <span class="token function">getImport</span><span class="token punctuation">(</span>handle<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/** Import from a given path */</span>
  <span class="token keyword">async</span> <span class="token generic-function"><span class="token function">importFrom</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>location<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token comment">/** Get an install command for a given npm module */</span>
  <span class="token function">getInstallCommand</span><span class="token punctuation">(</span>pkg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> production <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h3 id="class-and-function-metadata">Class and Function Metadata</h3>

For the framework to work properly, metadata needs to be collected about files, classes and functions to uniquely identify them, with support for detecting changes during live reloads.  To achieve this, every <code class="item input">class</code> is decorated with metadata, including methods, line numbers, and ultimately a unique id stored at <code class="item input">Ⲑid</code>.

<h2 id="environment-support">Environment Support</h2>

The functionality we support for testing and retrieving environment information for known environment variables. They can be accessed directly on the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/env.ts#L114">Env</a> object, and will return a scoped <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/env.ts#L8">EnvProp</a>, that is compatible with the property definition.  E.g. only showing boolean related fields when the underlying flag supports <code class="item input">true</code> or <code class="item input">false</code>

  <figure class="code">
    <figcaption class="code">Base Known Environment Flags
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/trv.d.ts#L6">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">EnvData</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token comment">/**
   * The node environment we are running in
   * @default development
   */</span>
  <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token string">'development'</span> <span class="token operator">|</span> <span class="token string">'production'</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Outputs all console.debug messages, defaults to off
   */</span>
  <span class="token constant">DEBUG</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * The role we are running as, allows access to additional files from the manifest during runtime.
   */</span>
  <span class="token constant">TRV_ROLE</span><span class="token operator">:</span> Role<span class="token punctuation">;</span>
  <span class="token comment">/**
   * The folders to use for resource lookup
   */</span>
  <span class="token constant">TRV_RESOURCES</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Resource path overrides
   * @private
   */</span>
  <span class="token constant">TRV_RESOURCE_OVERRIDES</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * The max time to wait for shutdown to finish after initial SIGINT,
   * @default 2s
   */</span>
  <span class="token constant">TRV_SHUTDOWN_WAIT</span><span class="token operator">:</span> TimeSpan <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * The desired runtime module
   */</span>
  <span class="token constant">TRV_MODULE</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * The location of the manifest file
   * @default undefined
   */</span>
  <span class="token constant">TRV_MANIFEST</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * trvc log level
   */</span>
  <span class="token constant">TRV_BUILD</span><span class="token operator">:</span> <span class="token string">'none'</span> <span class="token operator">|</span> <span class="token string">'info'</span> <span class="token operator">|</span> <span class="token string">'debug'</span> <span class="token operator">|</span> <span class="token string">'error'</span> <span class="token operator">|</span> <span class="token string">'warn'</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Should break on first line of a method when using the @DebugBreak decorator
   * @default false
   */</span>
  <span class="token constant">TRV_DEBUG_BREAK</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h3 id="environment-property">Environment Property</h3>

For a given <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/env.ts#L8">EnvProp</a>, we support the ability to access different properties as a means to better facilitate environment variable usage.

  <figure class="code">
    <figcaption class="code">EnvProp Shape
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/env.ts#L8">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">EnvProp<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">readonly</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span> <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span> <span class="token punctuation">{{'}'}}</span>
  <span class="token comment">/** Remove value */</span>
  <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token comment">/** Export value */</span>
  <span class="token keyword">export</span><span class="token punctuation">(</span>value<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token comment">/** Read value as string */</span>
  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">/** Read value as list */</span>
  <span class="token keyword">get</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">/** Read value as object */</span>
  <span class="token keyword">get</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">/** Add values to list */</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">...</span>items<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token comment">/** Read value as int  */</span>
  <span class="token keyword">get</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">/** Read value as boolean */</span>
  <span class="token keyword">get</span> <span class="token function">bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token comment">/** Determine if the underlying value is truthy */</span>
  <span class="token keyword">get</span> <span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token comment">/** Determine if the underlying value is falsy */</span>
  <span class="token keyword">get</span> <span class="token function">isFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token comment">/** Determine if the underlying value is set */</span>
  <span class="token keyword">get</span> <span class="token function">isSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="standard-error-support">Standard Error Support</h2>

While the framework is 100 % compatible with standard <code class="item input">Error</code> instances, there are cases in which additional functionality is desired. Within the framework we use <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/error.ts#L17">RuntimeError</a> (or its derivatives) to represent framework errors. This class is available for use in your own projects. Some of the additional benefits of using this class is enhanced error reporting, as well as better integration with other modules (e.g. the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/web" title="Declarative support for creating Web Applications">Web API</a> module and HTTP status codes). <br><br>
The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/error.ts#L17">RuntimeError</a> takes in a message, and an optional payload and / or error classification. The currently supported error classifications are:
<ul> <li><code class="item input">general</code> - General purpose errors</li>
<li><code class="item input">system</code> - Synonym for <code class="item input">general</code></li>
<li><code class="item input">data</code> - Data format, content, etc are incorrect. Generally correlated to bad input.</li>
<li><code class="item input">permission</code> - Operation failed due to lack of permissions</li>
<li><code class="item input">auth</code> - Operation failed due to lack of authentication</li>
<li><code class="item input">missing</code> - Resource was not found when requested</li>
<li><code class="item input">timeout</code> - Operation did not finish in a timely manner</li>
<li><code class="item input">unavailable</code> - Resource was unresponsive</li>
</ul>

<h2 id="console-management">Console Management</h2>

This module provides logging functionality, built upon <a target="_blank" class="external-link" href="https://nodejs.org/api/console.html">console</a> operations. <br><br>
The supported operations are:
<ul> <li><code class="item method">console.error</code> which logs at the <code class="item input">ERROR</code> level</li>
<li><code class="item method">console.warn</code> which logs at the <code class="item input">WARN</code> level</li>
<li><code class="item method">console.info</code> which logs at the <code class="item input">INFO</code> level</li>
<li><code class="item method">console.debug</code> which logs at the <code class="item input">DEBUG</code> level</li>
<li><code class="item method">console.log</code> which logs at the <code class="item input">INFO</code> level</li>
</ul>

<p class="note"><strong>Note</strong> All other console methods are excluded, specifically <code class="item method">trace</code>, <code class="item method">inspect</code>, <code class="item method">dir</code>, <code class="item method">time</code>/<code class="item method">timeEnd</code></p>

<h3 id="how-logging-is-instrumented">How Logging is Instrumented</h3>

All of the logging instrumentation occurs at transpilation time.  All <code class="item method">console.*</code> methods are replaced with a call to a globally defined variable that delegates to the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/console.ts#L43">ConsoleManager</a>.  This module, hooks into the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/console.ts#L43">ConsoleManager</a> and receives all logging events from all files compiled by the <a target="_blank" class="external-link" href="https://travetto.dev">Travetto</a>. <br><br>
A sample of the instrumentation would be:

  <figure class="code">
    <figcaption class="code">Sample logging at various levels
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/doc/transpile.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Start Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Divide by zero'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> error <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'End Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

  <figure class="code">
    <figcaption class="code">Sample After Transpilation
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/doc/transpile.js">Source</a></cite>

</figcaption>
    <pre><code class="language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Δ<span class="token keyword">function</span> <span class="token keyword">from</span> <span class="token string">"@travetto/runtime/src/function.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Δconsole <span class="token keyword">from</span> <span class="token string">"@travetto/runtime/src/console.js"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Δm_1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"@travetto/runtime"</span><span class="token punctuation">,</span> <span class="token string">"doc/transpile.ts"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    Δconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token string">"debug"</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token operator">:</span> Δm_1<span class="token punctuation">,</span> <span class="token literal-property property">line</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token string">"work"</span><span class="token punctuation">,</span> <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Start Work'</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        Δconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token operator">:</span> Δm_1<span class="token punctuation">,</span> <span class="token literal-property property">line</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token string">"work"</span><span class="token punctuation">,</span> <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Divide by zero'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> error <span class="token punctuation">{{'}'}}</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    Δconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token string">"debug"</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token operator">:</span> Δm_1<span class="token punctuation">,</span> <span class="token literal-property property">line</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token string">"work"</span><span class="token punctuation">,</span> <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'End Work'</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span>
Δ<span class="token keyword">function</span><span class="token punctuation">.</span><span class="token function">registerFunction</span><span class="token punctuation">(</span>work<span class="token punctuation">,</span> Δm_1<span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token number">159357293</span><span class="token punctuation">,</span> <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
  </figure>

<h4 id="filtering-debug">Filtering Debug</h4>

The <code class="item input">debug</code> messages can be filtered using the patterns from the <a target="_blank" class="external-link" href="https://www.npmjs.com/package/debug">debug</a>.  You can specify wild cards to only <code class="item input">DEBUG</code> specific modules, folders or files.  You can specify multiple, and you can also add negations to exclude specific packages.

  <figure class="terminal">
    <figcaption class="terminal">Sample environment flags

</figcaption>
    <pre><code class="language-bash"><span class="token comment"># Debug</span>
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>-@travetto/model npx trv run app
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>-@travetto/registry npx trv run app
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>@travetto/web npx trv run app
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>@travetto/*,-@travetto/model npx trv run app</code></pre>
  </figure>

Additionally, the logging framework will merge <a target="_blank" class="external-link" href="https://www.npmjs.com/package/debug">debug</a> into the output stream, and supports the standard usage

  <figure class="terminal">
    <figcaption class="terminal">Sample environment flags for standard usage

</figcaption>
    <pre><code class="language-bash"><span class="token comment"># Debug</span>
$ <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span>express:*,@travetto/web npx trv run web</code></pre>
  </figure>

<h2 id="resource-access">Resource Access</h2>

The primary access patterns for resources, is to directly request a file, and to resolve that file either via file-system look up or leveraging the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/manifest" title="Support for project indexing, manifesting, along with file watching">Manifest</a>'s data for what resources were found at manifesting time.<br><br>
The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/file-loader.ts#L11">FileLoader</a> allows for accessing information about the resources, and subsequently reading the file as text/binary or to access the resource as a <code class="item class">Readable</code> stream.  If a file is not found, it will throw an <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/error.ts#L17">RuntimeError</a> with a category of 'notfound'.  <br><br>
The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/file-loader.ts#L11">FileLoader</a> also supports tying itself to <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/env.ts#L114">Env</a>'s <code class="item field">TRV_RESOURCES</code> information on where to attempt to find a requested resource.

<h2 id="encoding-and-decoding-utilities">Encoding and Decoding Utilities</h2>

The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/codec.ts#L10">CodecUtil</a> class provides a variety of static methods for encoding and decoding data. When working with JSON data, it also provide security checks to prevent prototype pollution. The utility supports the following formats:
<ul> <li>Hex</li>
<li>Base64</li>
<li>UTF8</li>
<li>UTT8 Encoded JSON</li>
<li>Base64 Encoded JSON</li>
<li>New Line Delimited UTF8</li>
</ul>

<h2 id="common-utilities">Common Utilities</h2>

Common utilities used throughout the framework. Currently <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/util.ts#L13">Util</a> includes:
<ul> <li><code class="item method">uuid(len: number)</code> generates a simple uuid for use within the application.</li>
<li><code class="item method">allowDenyMatcher(rules[])</code> builds a matching function that leverages the rules as an allow/deny list, where order of the rules matters.  Negative rules are prefixed by '!'.</li>
<li><code class="item method">hash(text: string, size?: number)</code> produces a full sha512 hash.</li>
<li><code class="item method">resolvablePromise()</code> produces a <code class="item class">Promise</code> instance with the <code class="item method">resolve</code> and <code class="item method">reject</code> methods attached to the instance.  This is extremely useful for integrating promises into async iterations, or any other situation in which the promise creation and the execution flow don't always match up.</li>
<li><code class="item method">bufferedFileWrite(file:string, content: string)</code> will write the file, using a temporary buffer file to ensure that the entire file is written before being moved to the final location.  This helps minimize file watch noise when writing files.</li>
</ul>

  <figure class="code">
    <figcaption class="code">Sample makeTemplate Usage

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">const</span> tpl <span class="token operator">=</span> <span class="token function">makeTemplate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token string">'age'</span><span class="token operator">|</span><span class="token string">'name'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">**</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span>name<span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span>value<span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token string">**</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tpl`<span class="token punctuation">{{'{'}}</span><span class="token punctuation">{{'{'}}</span>age<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">{{'}'}}</span><span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'{'}}</span><span class="token punctuation">{{'{'}}</span>name<span class="token operator">:</span> <span class="token string">'bob'</span><span class="token punctuation">{{'}'}}</span><span class="token punctuation">{{'}'}}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// produces</span>
<span class="token string">'**age: 20** **name: bob**'</span></code></pre>
  </figure>

<h2 id="binary-utilities">Binary Utilities</h2>

The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/binary.ts#L59">BinaryUtil</a> class provides a unified interface for working with binary data across different formats, especially bridging the gap between Node.js specific types (<code class="item input">Buffer</code>, <code class="item input">Stream</code>) and Web Standard types (<code class="item input">Blob</code>, <code class="item input">ArrayBuffer</code>). The framework leverages this to allow for seamless handling of binary data, regardless of the source.

<h2 id="json-utilities">JSON Utilities</h2>

The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/json.ts#L31">JSONUtil</a> class provides a comprehensive set of utilities for working with JSON data, including serialization, deserialization, encoding, and deep cloning capabilities. The utility handles special types like <code class="item input">Date</code>, <code class="item input">BigInt</code>, and <code class="item input">Error</code> objects seamlessly. Key features include:
<ul> <li><code class="item method">fromUTF8(input, config?)</code> - Parse JSON from a UTF-8 string</li>
<li><code class="item method">toUTF8(value, config?)</code> - Serialize a value to JSON string</li>
<li><code class="item method">toUTF8Pretty(value)</code> - Serialize with pretty formatting (2-space indent)</li>
<li><code class="item method">fromBinaryArray(input)</code> - Parse JSON from binary array</li>
<li><code class="item method">toBinaryArray(value, config?)</code> - Serialize to binary array (UTF-8 encoded)</li>
<li><code class="item method">toBase64(value)</code> - Encode JSON as base64 string</li>
<li><code class="item method">fromBase64(input)</code> - Decode JSON from base64 string</li>
<li><code class="item method">clone(input, config?)</code> - Deep clone objects with optional transformations</li>
<li><code class="item method">cloneForTransmit(input)</code> - Clone for transmission with error serialization</li>
<li><code class="item method">cloneFromTransmit(input)</code> - Clone from transmission with type restoration</li>
</ul>
The <code class="item input">TRANSMIT_REVIVER</code> automatically restores <code class="item input">Date</code> objects and <code class="item input">BigInt</code> values during deserialization, making it ideal for transmitting complex data structures across network boundaries.

<h2 id="time-utilities">Time Utilities</h2>

<a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/time.ts#L21">TimeUtil</a> contains general helper methods, created to assist with time-based inputs via environment variables, command line interfaces, and other string-heavy based input.

  <figure class="code">
    <figcaption class="code">Time Utilities
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/time.ts#L21">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">TimeUtil</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token comment">/**
   * Test to see if a string is valid for relative time
   */</span>
  <span class="token keyword">static</span> <span class="token function">isTimeSpan</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> value <span class="token keyword">is</span> TimeSpan<span class="token punctuation">;</span>
  <span class="token comment">/**
   * Exposes the ability to create a duration succinctly
   */</span>
  <span class="token keyword">static</span> <span class="token function">duration</span><span class="token punctuation">(</span>input<span class="token operator">:</span> TimeSpan <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span> outputUnit<span class="token operator">:</span> TimeUnit<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * Returns a new date with `amount` units into the future
   */</span>
  <span class="token keyword">static</span> <span class="token function">fromNow</span><span class="token punctuation">(</span>input<span class="token operator">:</span> TimeSpan <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Date<span class="token punctuation">;</span>
  <span class="token comment">/**
   * Returns a pretty timestamp
   */</span>
  <span class="token keyword">static</span> <span class="token function">asClock</span><span class="token punctuation">(</span>input<span class="token operator">:</span> TimeSpan <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="process-execution">Process Execution</h2>

<a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/runtime/src/exec.ts#L40">ExecUtil</a> exposes <code class="item method">getResult</code> as a means to wrap <a target="_blank" class="external-link" href="https://nodejs.org/api/child_process.html">child_process</a>'s process object.  This wrapper allows for a promise-based resolution of the subprocess with the ability to capture the stderr/stdout.<br><br>
A simple example would be:

  <figure class="code">
    <figcaption class="code">Running a directory listing via ls
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/doc/exec.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> spawn <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'node:child_process'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> ExecUtil <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/runtime'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">executeListing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">const</span> final <span class="token operator">=</span> <span class="token keyword">await</span> ExecUtil<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Listing'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> lines<span class="token operator">:</span> final<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="shutdown-management">Shutdown Management</h2>

Another key lifecycle is the process of shutting down. The framework provides centralized functionality for running operations on graceful shutdown. Primarily used by the framework for cleanup operations, this provides a clean interface for registering shutdown handlers. The code intercepts <code class="item input">SIGTERM</code> and <code class="item input">SIGUSR2</code>, with a default threshold of 2 seconds. These events will start the shutdown process, but also clear out the pending queue. If a kill signal is sent again, it will complete immediately. <br><br>
As a registered shutdown handler, you can do.

  <figure class="code">
    <figcaption class="code">Registering a shutdown handler
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/runtime/doc/shutdown.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> ShutdownManager <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/runtime'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">registerShutdownHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
  ShutdownManager<span class="token punctuation">.</span>signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token comment">// Do important work, the framework will wait until all async</span>
    <span class="token comment">//   operations are completed before finishing shutdown</span>
  <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<h2 id="path-behavior">Path Behavior</h2>

To ensure consistency in path usage throughout the framework, imports pointing at <code class="item input">node:path</code> and <code class="item input">path</code> are rewritten at compile time.  These imports are pointing towards <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/manifest" title="Support for project indexing, manifesting, along with file watching">Manifest</a>'s <code class="item input">path</code>  implementation.  This allows for seamless import/usage patterns with the reliability needed for cross platform support.
