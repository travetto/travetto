<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/log/doc.ts and execute "npx trv doc" to rebuild -->
# Logging
## Logging framework that integrates at the console.log level.

**Install: @travetto/log**
```bash
npm install @travetto/log
```

This module provides logging functionality, building upon [ConsoleManager](https://github.com/travetto/travetto/tree/main/module/base/src/console.ts) in the [Base](https://github.com/travetto/travetto/tree/main/module/base#readme "Application phase management, environment config and common utilities for travetto applications.") module.  This is all ultimately built upon [console](https://nodejs.org/api/console.html) operations. 

The supported operations are:
   
   *  `console.error` which logs at the `ERROR` level
   *  `console.warn` which logs at the `WARN` level
   *  `console.info` which logs at the `INFO` level
   *  `console.debug` which logs at the `DEBUG` level
   *  `console.log` which logs at the `INFO` level

**Note**: All other console methods are excluded, specifically `trace`, `inspect`, `dir`, `time`/`timeEnd`

## Filtering Debug

The `debug` messages can be filtered using the patterns from the [debug](https://www.npmjs.com/package/debug).  You can specify wild cards to only `DEBUG` specific modules, folders or files.  You can specify multiple, and you can also add negations to exclude specific packages.

**Terminal: Sample environment flags**
```bash
# Debug
$ DEBUG=@app:*,-@trv:model npx trv run app
$ DEBUG=-@trv:registry npx trv run app
$ DEBUG=@trv:rest npx trv run app
$ DEBUG=@trv:*,-@trv:model npx trv run app
```

**Note**: In production mode, all `console.debug` invocations are compiled away for performance/security reasons. This means that the code is actually removed, and will not execute.

## How Logging is Instrumented

All of the logging instrumentation occurs at transpilation time.  All `console.*` methods are replaced with a call to a globally defined variable that delegates to the [ConsoleManager](https://github.com/travetto/travetto/tree/main/module/base/src/console.ts).  This module, hooks into the [ConsoleManager](https://github.com/travetto/travetto/tree/main/module/base/src/console.ts) and receives all logging events from all files compiled by the [Compiler](https://github.com/travetto/travetto/tree/main/module/compiler#readme "Node-integration of Typescript Compiler with advanced functionality for detecting changes in classes and methods.") module.

A sample of the instrumentation would be:

**Code: Sample logging at various levels**
```typescript
export function work() {
  console.debug('Start Work');

  try {
    1 / 0;
  } catch (err) {
    console.error('Divide by zero', { error: err });
  }
  console.debug('End Work');
}
```

**Code: Sample After Transpilation**
```javascript
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.work = void 0;
function work() {
    ᚕlg("debug", { file: ᚕsrc(__filename), line: 2, scope: "work" }, 'Start Work');
    try {
        1 / 0;
    }
    catch (err) {
        ᚕlg("error", { file: ᚕsrc(__filename), line: 7, scope: "work" }, 'Divide by zero', { error: err });
    }
    ᚕlg("debug", { file: ᚕsrc(__filename), line: 9, scope: "work" }, 'End Work');
}
exports.work = work;
Object.defineProperty(exports, 'ᚕtrv', { configurable: true, value: true });
```

And when in `prod` mode transforms into:

**Code: Sample After Transpilation, in Prod**
```javascript
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.work = void 0;
function work() {
    try {
        1 / 0;
    }
    catch (err) {
        ᚕlg("error", { file: ᚕsrc(__filename), line: 5, scope: "work" }, 'Divide by Zero', { error: err });
    }
}
exports.work = work;
Object.defineProperty(exports, 'ᚕtrv', { configurable: true, value: true });
```

## Logging to External Systems
By default the logging functionality logs messages directly to the console, relying on the `util.inspect` method, as is the standard behavior.  When building distributed systems, with multiple separate logs, it is useful to rely on structured logging for common consumption.  The framework supports logging as [JSON](https://www.json.org), which is easily consumable by services like [elasticsearch](https://elastic.co) or [AWS Cloudwatch](https://aws.amazon.com/cloudwatch/) if running as a lambda or in a docker container.  

The main caveat that comes with this, is that not all objects can be converted to JSON (specifically circular dependencies, and unsupported types).  That end, the framework recommends logging with the following format, `message: string` `context: Record<string, Primitive>`.  Here context can be recursive, but the general idea is to only pass in known data structures that will not break the [JSON](https://www.json.org) production.

## Sample Output

The logging output, as indicated provides context for location of invocation. Given the file `test/simple.ts`:

**Code: Various log levels**
```typescript
export async function main() {
  console.log('Hello World');

  console.log('Woah!', { a: { b: { c: { d: 10 } } } });

  console.info('Woah!');

  console.debug('Test');
}
```

The corresponding output would be

**Terminal: Logging output**
```bash
$ node @travetto/base/bin/main ./doc/output.ts 

2022-03-14T04:00:00.618Z info  [@trv:log/doc/output:2] Hello World
2022-03-14T04:00:00.837Z info  [@trv:log/doc/output:4] Woah! {
2022-03-14T04:00:01.510Z info  [@trv:log/doc/output:6] Woah!
2022-03-14T04:00:02.450Z debug [@trv:log/doc/output:8] Test
```
