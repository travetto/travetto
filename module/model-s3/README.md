<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/model-s3/DOC.tsx and execute "npx trv doc" to rebuild -->
# S3 Model Support

## S3 backing for the travetto model module.

**Install: @travetto/model-s3**
```bash
npm install @travetto/model-s3

# or

yarn add @travetto/model-s3
```

This module provides an [s3](https://aws.amazon.com/documentation/s3/)-based implementation for the [Data Modeling Support](https://github.com/travetto/travetto/tree/main/module/model#readme "Datastore abstraction for core operations.").  This source allows the [Data Modeling Support](https://github.com/travetto/travetto/tree/main/module/model#readme "Datastore abstraction for core operations.") module to read, write and stream against [s3](https://aws.amazon.com/documentation/s3/). 

Supported features:
   *  [CRUD](https://github.com/travetto/travetto/tree/main/module/model/src/service/crud.ts#L11)
   *  [Blob](https://github.com/travetto/travetto/tree/main/module/model/src/service/blob.ts#L12)
   *  [Expiry](https://github.com/travetto/travetto/tree/main/module/model/src/service/expiry.ts#L11)
Out of the box, by installing the module, everything should be wired up by default.If you need to customize any aspect of the source or config, you can override and register it with the [Dependency Injection](https://github.com/travetto/travetto/tree/main/module/di#readme "Dependency registration/management and injection support.") module.

**Code: Wiring up a custom Model Source**
```typescript
import { InjectableFactory } from '@travetto/di';
import { S3ModelConfig, S3ModelService } from '@travetto/model-s3';

export class Init {
  @InjectableFactory({
    primary: true
  })
  static getModelSource(conf: S3ModelConfig) {
    return new S3ModelService(conf);
  }
}
```

where the [S3ModelConfig](https://github.com/travetto/travetto/tree/main/module/model-s3/src/config.ts#L12) is defined by:

**Code: Structure of S3ModelConfig**
```typescript
import { fromIni } from '@aws-sdk/credential-provider-ini';
import type s3 from '@aws-sdk/client-s3';

import { Config, EnvVar } from '@travetto/config';
import { Field, Required } from '@travetto/schema';
import { Runtime } from '@travetto/runtime';

/**
 * S3 Support as an Asset Source
 */
@Config('model.s3')
export class S3ModelConfig {
  region = 'us-east-1'; // AWS Region
  namespace = ''; // S3 Bucket folder
  bucket = ''; // S3 bucket
  endpoint = ''; // Endpoint url

  @EnvVar('AWS_ACCESS_KEY_ID')
  accessKeyId: string = '';
  @EnvVar('AWS_SECRET_ACCESS_KEY')
  secretAccessKey: string = '';
  @EnvVar('AWS_PROFILE')
  profile?: string;

  @Field(Object)
  @Required(false)
  config: s3.S3ClientConfig; // Additional s3 config

  chunkSize = 5 * 2 ** 20; // Chunk size in bytes

  autoCreate?: boolean;

  /**
   * Provide host to bucket
   */
  get hostName(): string {
    return `${this.bucket}.s3.amazonaws.com`;
  }

  /**
   * Produces the s3 config from the provide details, post construction
   */
  async postConstruct(): Promise<void> {
    if (!this.accessKeyId && !this.secretAccessKey) {
      const creds = await fromIni({ profile: this.profile })();
      this.accessKeyId = creds.accessKeyId;
      this.secretAccessKey = creds.secretAccessKey;
    }

    this.config = {
      ...(this.config ?? {}),
      region: this.region,
      endpoint: this.endpoint,
      credentials: {
        accessKeyId: this.accessKeyId,
        secretAccessKey: this.secretAccessKey
      }
    };

    // We are in localhost and not in prod, turn on forcePathStyle
    if (!Runtime.production && this.endpoint.includes('localhost')) {
      this.config.forcePathStyle ??= true;
    }
  }
}
```

Additionally, you can see that the class is registered with the [@Config](https://github.com/travetto/travetto/tree/main/module/config/src/decorator.ts#L13) annotation, and so these values can be overridden using the standard [Configuration](https://github.com/travetto/travetto/tree/main/module/config#readme "Configuration support") resolution paths.

**Note**: Do not commit your `accessKeyId` or `secretAccessKey` values to your source repository, especially if it is public facing.  Not only is it a security risk, but Amazon will scan public repos, looking for keys, and if found will react swiftly.
