<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/base/doc/index.ts and execute "npx trv doc" to rebuild -->
<h1>Base
          <small>Environment config and common utilities for travetto applications.</small>

        </h1>

      <figure class="install">
      <figcaption class="install">Install @travetto/base
      
      </figcaption>
      <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/base</code></pre>     
      </figure>

Base is the foundation of all <a target="_blank" class="external-link" href="https://travetto.dev">Travetto</a> applications.  It is intended to be a minimal application set, as well as support for commonly shared functionality. It has support for the following key areas:

<ul> <li>Environment Support</li>
 <li>Standard Error Support</li>
 <li>Stream Support</li>
 <li>General Utilities</li>
 <li>Process Execution</li></ul>

<h2 id="environment-support">Environment Support</h2>
The functionality we support for testing and retrieving environment information:
<ul> <li><code class="item method">isTrue(key: string): boolean;</code> - Test whether or not an environment flag is set and is true</li>
 <li><code class="item method">isFalse(key: string): boolean;</code> - Test whether or not an environment flag is set and is false</li>
 <li><code class="item method">isSet(key:string): boolean;</code> - Test whether or not an environment value is set (excludes: <code class="item input">null</code>, <code class="item input">''</code>, and <code class="item input">undefined</code>)</li>
 <li><code class="item method">get(key: string, def?: string): string;</code> - Retrieve an environmental value with a potential default</li>
 <li><code class="item method">getInt(key: string, def?: number): number;</code> - Retrieve an environmental value as a number</li>
 <li><code class="item method">getList(key: string): string[];</code> - Retrieve an environmental value as a list</li></ul>

<h2 id="standard-error-support">Standard Error Support</h2>

While the framework is 100 % compatible with standard <code class="item input">Error</code> instances, there are cases in which additional functionality is desired. Within the framework we use <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/base/src/error.ts#L13">AppError</a> (or its derivatives) to represent framework errors. This class is available for use in your own projects. Some of the additional benefits of using this class is enhanced error reporting, as well as better integration with other modules (e.g. the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/rest" title="Declarative api for RESTful APIs with support for the dependency injection module.">RESTful API</a> module and HTTP status codes).  

The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/base/src/error.ts#L13">AppError</a> takes in a message, and an optional payload and / or error classification. The currently supported error classifications are:
<ul> <li><code class="item input">general</code> - General purpose errors</li>
 <li><code class="item input">system</code> - Synonym for <code class="item input">general</code></li>
 <li><code class="item input">data</code> - Data format, content, etc are incorrect. Generally correlated to bad input.</li>
 <li><code class="item input">permission</code> - Operation failed due to lack of permissions</li>
 <li><code class="item input">auth</code> - Operation failed due to lack of authentication</li>
 <li><code class="item input">missing</code> - Resource was not found when requested</li>
 <li><code class="item input">timeout</code> - Operation did not finish in a timely manner</li>
 <li><code class="item input">unavailable</code> - Resource was unresponsive</li></ul>

<h2 id="stream-support">Stream Support</h2>
The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/base/src/stream.ts#L11">StreamUtil</a> class provides basic stream utilities for use within the framework:

<ul> <li><code class="item method">toBuffer(src: Readable | Buffer | string): Promise&lt;Buffer&gt;</code> for converting a stream/buffer/filepath to a Buffer.</li>
 <li><code class="item method">toReadable(src: Readable | Buffer | string):Promise&lt;Readable&gt;</code> for converting a stream/buffer/filepath to a Readable</li>
 <li><code class="item method">writeToFile(src: Readable, out: string):Promise&lt;void&gt;</code> will stream a readable into a file path, and wait for completion.</li>
 <li><code class="item method">waitForCompletion(src: Readable, finish:()=&gt;Promise&lt;any&gt;)</code> will ensure the stream remains open until the promise finish produces is satisfied.</li></ul>

<h2 id="general-utilities">General Utilities</h2>
Simple functions for providing a minimal facsimile to <a target="_blank" class="external-link" href="https://lodash.com">lodash</a>, but without all the weight. Currently <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/base/src/util.ts#L16">Util</a> includes:

<ul> <li><code class="item method">isPrimitive(el)</code> determines if <code class="item input">el</code> is a <code class="item input">string</code>, <code class="item input">boolean</code>, <code class="item input">number</code> or <code class="item input">RegExp</code></li>
 <li><code class="item method">isPlainObject(obj)</code> determines if the obj is a simple object</li>
 <li><code class="item method">isFunction(o)</code> determines if <code class="item input">o</code> is a simple <code class="item input">Function</code></li>
 <li><code class="item method">isClass(o)</code> determines if <code class="item input">o</code> is a class constructor</li>
 <li><code class="item method">isSimple(a)</code> determines if <code class="item input">a</code> is a simple value</li>
 <li><code class="item method">deepAssign(a, b, mode ?)</code> which allows for deep assignment of <code class="item input">b</code> onto <code class="item input">a</code>, the <code class="item input">mode</code> determines how aggressive the assignment is, and how flexible it is.  <code class="item input">mode</code> can have any of the following values: <ul> <li><code class="item input">loose</code>, which is the default is the most lenient. It will not error out, and overwrites will always happen</li>
 <li><code class="item input">coerce</code>, will attempt to force values from <code class="item input">b</code> to fit the types of <code class="item input">a</code>, and if it can't it will error out</li>
 <li><code class="item input">strict</code>, will error out if the types do not match</li></ul></li>
 <li><code class="item method">uuid(len: number)</code> generates a simple uuid for use within the application.</li>
 <li><code class="item method">allowDenyMatcher(rules[])</code> builds a matching function that leverages the rules as an allow/deny list, where order of the rules matters.  Negative rules are prefixed by '!'.</li></ul>

<h2 id="process-execution">Process Execution</h2>
Just like <a target="_blank" class="external-link" href="https://nodejs.org/api/child_process.html">child_process</a>, the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/base/src/exec.ts#L87">ExecUtil</a> exposes <code class="item method">spawn</code> and <code class="item method">fork</code>.  These are generally wrappers around the underlying functionality.  In addition to the base functionality, each of those functions is converted to a <code class="item input">Promise</code> structure, that throws an error on an non-zero return status.

A simple example would be:

      <figure class="code">
      <figcaption class="code">Running a directory listing via ls
      <cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/base/doc/src/exec.ts">Source</a></cite>
      </figcaption>
      <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> ExecUtil <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/base'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">executeListing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">const</span> <span class="token punctuation">{{'{'}}</span> result <span class="token punctuation">{{'}'}}</span> <span class="token operator">=</span> ExecUtil<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> final <span class="token operator">=</span> <span class="token keyword">await</span> result<span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Listing'</span><span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> lines<span class="token operator">:</span> final<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>     
      </figure>

As you can see, the call returns not only the child process information, but the <code class="item input">Promise</code> to wait for.  Additionally, some common patterns are provided for the default construction of the child process. In addition to the standard options for running child processes, the module also supports:

<ul> <li><code class="item input">timeout</code> as the number of milliseconds the process can run before terminating and throwing an error</li>
 <li><code class="item input">quiet</code> which suppresses all stdout/stderr output</li>
 <li><code class="item input">stdin</code> as a string, buffer or stream to provide input to the program you are running;</li>
 <li><code class="item input">timeoutKill</code> allows for registering functionality to execute when a process is force killed by timeout</li></ul>
