<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/boot/README.ts and execute "npx trv doc" to rebuild -->
# Boot
## Bootstrapping and application phase management for travetto applications.

**Install: @travetto/boot**
```bash
npm install @travetto/boot
```

Boot is basic environment  awareness coupled with typescript bootstrapping for [Travetto](https://travetto.dev) apps and libraries.  It has support for the following key areas:
   
   *  Module Indexing
   *  Main Entry Bootstrapping
   *  Console Management
   *  Shutdown Management

### Module Indexing
The bootstrap process will also produce an index of all source files, which allows for fast in-memory scanning.  This allows for all the automatic discovery that is used within the framework.

## Shutdown Management

Another key lifecycle is the process of shutting down. The framework provides centralized functionality for running operations on shutdown. Primarily used by the framework for cleanup operations, this provides a clean interface for registering shutdown handlers. The code overrides `process.exit` to properly handle `SIGKILL` and `SIGINT`, with a default threshold of 3 seconds. In the advent of a `SIGTERM` signal, the code exits immediately without any cleanup.

As a registered shutdown handler, you can do.

**Code: Registering a shutdown handler**
```typescript
import { ShutdownManager } from '@travetto/boot';

export function registerShutdownHandler() {
  ShutdownManager.onShutdown('handler-name', async () => {
    // Do important work, the framework will wait until all async
    //   operations are completed before finishing shutdown
  });
}
```

## Console Management

This module provides logging functionality, built upon [console](https://nodejs.org/api/console.html) operations. 

The supported operations are:
   
   *  `console.error` which logs at the `ERROR` level
   *  `console.warn` which logs at the `WARN` level
   *  `console.info` which logs at the `INFO` level
   *  `console.debug` which logs at the `DEBUG` level
   *  `console.log` which logs at the `INFO` level

**Note**: All other console methods are excluded, specifically `trace`, `inspect`, `dir`, `time`/`timeEnd`

## How Logging is Instrumented

All of the logging instrumentation occurs at transpilation time.  All `console.*` methods are replaced with a call to a globally defined variable that delegates to the [ConsoleManager](https://github.com/travetto/travetto/tree/main/module/boot/src/console.ts).  This module, hooks into the [ConsoleManager](https://github.com/travetto/travetto/tree/main/module/boot/src/console.ts) and receives all logging events from all files compiled by the [Travetto](https://travetto.dev).

A sample of the instrumentation would be:

**Code: Sample logging at various levels**
```typescript
export function work() {
  console.debug('Start Work');

  try {
    1 / 0;
  } catch (err) {
    console.error('Divide by zero', { error: err });
  }
  console.debug('End Work');
}
```

**Code: Sample After Transpilation**
```javascript
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.work = void 0;
const tslib_1 = require("tslib");
const ᚕ_ = tslib_1.__importStar(require("@travetto/boot/support/init.helper.js"));
const __output = ᚕ_.trv.out(__filename);
function work() {
    ᚕ_.trv.log("debug", { source: __output, line: 2, scope: "work" }, 'Start Work');
    try {
        1 / 0;
    }
    catch (err) {
        ᚕ_.trv.log("error", { source: __output, line: 7, scope: "work" }, 'Divide by zero', { error: err });
    }
    ᚕ_.trv.log("debug", { source: __output, line: 9, scope: "work" }, 'End Work');
}
exports.work = work;
```

### Filtering Debug

The `debug` messages can be filtered using the patterns from the [debug](https://www.npmjs.com/package/debug).  You can specify wild cards to only `DEBUG` specific modules, folders or files.  You can specify multiple, and you can also add negations to exclude specific packages.

**Terminal: Sample environment flags**
```bash
# Debug
$ DEBUG=-@travetto/model npx trv run app
$ DEBUG=-@travetto/registry npx trv run app
$ DEBUG=@travetto/rest npx trv run app
$ DEBUG=@travetto/*,-@travetto/model npx trv run app
```

Additionally, the logging framework will merge [debug](https://www.npmjs.com/package/debug) into the output stream, and supports the standard usage

**Terminal: Sample environment flags for standard usage**
```bash
# Debug
$ DEBUG=express:*,@travetto/rest npx trv run rest
```
