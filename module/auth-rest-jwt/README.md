<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/auth-rest-jwt/DOC.tsx and execute "npx trv doc" to rebuild -->
# Rest Auth JWT

## Rest authentication JWT integration support for the Travetto framework

**Install: @travetto/auth-rest-jwt**
```bash
npm install @travetto/auth-rest-jwt

# or

yarn add @travetto/auth-rest-jwt
```

One of [Rest Auth](https://github.com/travetto/travetto/tree/main/module/auth-rest#readme "Rest authentication integration support for the Travetto framework")'s main responsibilities is being able to send and receive authentication/authorization information from the client.  This data can be encoded in many different forms, and this module provides the ability to encode into and decode from [JWT](https://jwt.io/)s. This module fulfills the contract required by [Rest Auth](https://github.com/travetto/travetto/tree/main/module/auth-rest#readme "Rest authentication integration support for the Travetto framework") of being able to encode and decode a user principal, by leveraging [JWT](https://github.com/travetto/travetto/tree/main/module/jwt#readme "JSON Web Token implementation")'s token generation features. 

The token can be encoded as a cookie or as a header depending on configuration.  Additionally, the encoding process allows for auto-renewing of the token if that is desired.  When encoding as a cookie, this becomes a seamless experience, and can be understood as a light-weight session. 

The [JWTPrincipalCodec](https://github.com/travetto/travetto/tree/main/module/auth-rest-jwt/src/codec.ts#L12) is exposed as a tool for allowing for converting an authenticated principal into a JWT, and back again.

**Code: JWTPrincipalCodec**
```typescript
import { AuthContext, Principal } from '@travetto/auth';
import { CommonPrincipalCodec, PrincipalCodec } from '@travetto/auth-rest';
import { Inject, Injectable } from '@travetto/di';
import { JWTSigner } from '@travetto/jwt';

import { RestJWTConfig } from './config';

/**
 * Principal codec via JWT
 */
@Injectable()
export class JWTPrincipalCodec extends CommonPrincipalCodec<string> implements PrincipalCodec {

  @Inject()
  config: RestJWTConfig = undefined!;

  @Inject()
  authContext: AuthContext;

  signer: JWTSigner<Principal>;

  postConstruct(): void {
    this.signer = new JWTSigner(this.config.signingKey!,
      v => ({
        expiresAt: v.expiresAt!,
        issuedAt: v.issuedAt!,
        issuer: v.issuer!,
        id: v.id,
        sessionId: v.sessionId
      })
    );
  }

  async toPayload(p: Principal | undefined): Promise<string | undefined> {
    return p ? await this.signer.create(p) : undefined;
  }

  async fromPayload(token: string): Promise<Principal | undefined> {
    const res = await this.signer.verify(token);
    this.authContext.authToken = { type: 'jwt', value: token };
    return res;
  }
}
```

As you can see, the encode token just creates a [JWT](https://jwt.io/) based on the principal provided, and decoding verifies the token, and returns the principal.
