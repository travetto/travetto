<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/openapi/DOC.tsx and execute "npx trv doc" to rebuild -->
# OpenAPI Specification

## OpenAPI integration support for the Travetto framework

**Install: @travetto/openapi**
```bash
npm install @travetto/openapi

# or

yarn add @travetto/openapi
```

In the [RESTful API](https://github.com/travetto/travetto/tree/main/module/rest#readme "Declarative api for RESTful APIs with support for the dependency injection module.") module, the controllers and endpoints can be described via decorators, comments, or typings. This only provides the general metadata internally. This is not sufficient to generate a usable API doc, and so this module exists to bridge that gap. 

The module is provides an [OpenAPI](https://github.com/OAI/OpenAPI-Specification) v3.x representation of the API metadata provided via the [RESTful API](https://github.com/travetto/travetto/tree/main/module/rest#readme "Declarative api for RESTful APIs with support for the dependency injection module.") and [Schema](https://github.com/travetto/travetto/tree/main/module/schema#readme "Data type registry for runtime validation, reflection and binding.") modules.

## Configuration
By installing the dependency, the [OpenAPI](https://github.com/OAI/OpenAPI-Specification) endpoint is automatically generated and exposed at the root of the application as `/openapi.yml` or `/openapi.json` (by default). 

All of the high level configurations can be found in the following structure:

**Code: Config: OpenAPI Configuration**
```typescript
import type { ServerObject, ContactObject, LicenseObject } from 'openapi3-ts/oas31';

import { Config } from '@travetto/config';
import { path, RuntimeIndex, RuntimeContext } from '@travetto/manifest';
import { Env } from '@travetto/base';
import { Required } from '@travetto/schema';

/**
 * API Information, infers as much as possible from the package.json
 */
@Config('api.info')
export class ApiInfoConfig {
  @Required(false)
  contact: ContactObject;
  @Required(false)
  description?: string;
  @Required(false)
  license: LicenseObject;
  @Required(false)
  termsOfService?: string;
  @Required(false)
  title: string;
  @Required(false)
  version: string;

  postConstruct(): void {
    this.title ??= RuntimeContext.mainModule;
    this.version ??= RuntimeContext.version;
    this.description ??= RuntimeContext.description;
  }
}

/**
 * The API host, infers from rest host configuration
 */
@Config('api.host')
export class ApiHostConfig {
  /**
   * List of servers
   */
  servers?: ServerObject[];
  /**
   * OpenAPI Version
   */
  openapi = '3.0.0';
}

/**
 * The spec file configuration
 */
@Config('api.spec')
export class ApiSpecConfig {
  /**
   * Where to output file to
   */
  output: string = 'openapi.yml';
  /**
   * Should file be generated at runtime
   */
  persist?: boolean;
  /**
   * Skip emitting all routes
   */
  skipRoutes: boolean = false;
  /**
   * Expose all schemas, even if not referenced
   */
  exposeAllSchemas: boolean = false;

  async postConstruct(): Promise<void> {
    if (!this.output || this.output === '-') {
      this.persist = false;
    } else {
      this.output = path.resolve(RuntimeIndex.mainModule.sourcePath, this.output);
      this.persist ??= Env.dynamic;
    }
    if (this.persist) {
      if (!/[.](json|ya?ml) $/.test(this.output)) { // Assume a folder
        this.output = path.resolve(this.output, 'openapi.yml');
      }
    }
  }
}
```

## Spec Generation
The framework, when in watch mode, will generate the [OpenAPI](https://github.com/OAI/OpenAPI-Specification) specification in either [JSON](https://www.json.org) or [YAML](https://en.wikipedia.org/wiki/YAML). This module integrates with the file watching paradigm and can regenerate the openapi spec as changes to endpoints and models are made during development.  The output format is defined by the suffix of the output file, `.yaml` or `.json`.

## CLI - openapi:spec
The module provides a command for the [Command Line Interface](https://github.com/travetto/travetto/tree/main/module/cli#readme "CLI infrastructure for Travetto framework") to allow scripting file generation.

**Terminal: OpenAPI usage**
```bash
$ trv openapi:spec --help

Usage: openapi:spec [options]

Options:
  -o, --output <string>  Output files
  -m, --module <module>  Module to run for
  -h, --help             display help for command
```

The command will run your application, in non-server mode, to collect all the routes and model information, to produce the `openapi.yml`.  Once produced, the code will store the output in the specified location.

**Note**: The module supports generating the OpenAPI spec in real-time while listening for changes to routes and models.

## CLI - openapi:client
The module provides a command for the [Command Line Interface](https://github.com/travetto/travetto/tree/main/module/cli#readme "CLI infrastructure for Travetto framework") to allow client generation from the API structure.

**Terminal: OpenAPI usage**
```bash
$ trv openapi:client --help

Usage: openapi:client [options] <format:string>

Options:
  -x, --extended-help                   Show Extended Help
  -a, --additional-properties <string>  Additional Properties (default: [])
  -i, --input <string>                  Input file (default: "./openapi.yml")
  -o, --output <string>                 Output folder (default: "./api-client")
  -d, --docker-image <string>           Docker Image to user (default: "arcsine/openapi-generator:latest")
  -w, --watch                           Watch for file changes
  -h, --help                            display help for command

Available Presets
----------------------------------
* @travetto/angular14 -- typescript-angular supportsES6=true,stringEnums=true,ngVersion=14.0,fileNaming=kebab-case
* @travetto/angular15 -- typescript-angular supportsES6=true,stringEnums=true,ngVersion=15.0,fileNaming=kebab-case
* @travetto/fetch -- typescript-fetch stringEnums=true
```

This tool relies upon a custom build of [OpenAPI client generation tools](https://github.com/OpenAPITools/openapi-generator), which supports watching.  This allows for fast responsive client generation as the shape of the API changes.
