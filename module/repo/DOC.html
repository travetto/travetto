<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/repo/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Repo
<small>Monorepo utilities</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install @travetto/repo
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/repo

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> @travetto/repo</code></pre>
  </figure>

The repo module aims to provide concise monorepo based tools.  The monorepo support within the <a target="_blank" class="external-link" href="https://travetto.dev">Travetto</a> framework, is based on <a target="_blank" class="external-link" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm">Npm</a>/<a target="_blank" class="external-link" href="https://yarnpg.com">Yarn</a> workspaces.  This module is not a requirement for monorepo support, but provides some quality of life improvements for:
<ul> <li>Versioning releases</li>
<li>Publishing releases</li>
<li>Listing local modules</li>
<li>Running commands on all workspace modules</li>
</ul>

<h2 id="cli-version">CLI - Version</h2>

The versioning operation will find all the changed modules (and the modules that depend on the changed), and will update the versions in accordance with the user preferences.  The versioning logic is backed by <a target="_blank" class="external-link" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm">Npm</a>'s and <a target="_blank" class="external-link" href="https://yarnpg.com">Yarn</a>'s versioning functionality and so it is identical to using the tool manually. The determination of what has or hasn't changed is relative to the last versioning commit.

  <figure class="terminal">
    <figcaption class="terminal">Version execution

</figcaption>
    <pre><code class="language-bash">$ trv repo:version <span class="token parameter variable">-h</span>

Usage: repo:version <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>level:major<span class="token operator">|</span>minor<span class="token operator">|</span>patch<span class="token operator">|</span>premajor<span class="token operator">|</span>preminor<span class="token operator">|</span>prepatch<span class="token operator">|</span>prerelease<span class="token operator">></span> <span class="token punctuation">[</span>prefix:string<span class="token punctuation">]</span>

Options:
  <span class="token parameter variable">--mode</span> <span class="token operator">&lt;</span>all<span class="token operator">|</span>changed<span class="token operator">|</span>direct<span class="token operator">></span>  The mode <span class="token keyword">for</span> versioning
  -f, <span class="token parameter variable">--force</span>                  Force operation, even <span class="token keyword">in</span> a dirty workspace <span class="token punctuation">(</span>default: <span class="token boolean">false</span><span class="token punctuation">)</span>
  --commit, --no-commit        Produce release commit message <span class="token punctuation">(</span>default: <span class="token boolean">true</span><span class="token punctuation">)</span>
  -m, <span class="token parameter variable">--modules</span> <span class="token operator">&lt;</span>string<span class="token operator">></span>       The module when mode is single
  -t, <span class="token parameter variable">--tag</span>                    Should we create a tag <span class="token keyword">for</span> the version
  -h, <span class="token parameter variable">--help</span>                   display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span></code></pre>
  </figure>

Level is a standard semver level of: major, minor, patch or prerelease.  The prefix argument only applies to the prerelease and allows for determining the prerelease level.  For example:

  <figure class="terminal">
    <figcaption class="terminal">Cutting a release candidate

</figcaption>
    <pre><code class="language-bash">npx trv repo:version prerelease rc</code></pre>
  </figure>

After a release is cut, a new commit will be created that marks the next stable point in the commit history.

  <figure class="code">
    <figcaption class="code">Versioning Commit

</figcaption>
    <pre><code class="language-bash">commit e9dc1a1de9625ab47398997fee6a95dd5a426900
Author: Travetto Framework <span class="token operator">&lt;</span>travetto.framework@gmail.com<span class="token operator">></span>
Date:   Thu Feb <span class="token number">23</span> <span class="token number">17</span>:51:37 <span class="token number">2023</span> <span class="token parameter variable">-0500</span>
Date:   Thu Feb <span class="token number">23</span> <span class="token number">17</span>:51:37 <span class="token number">2023</span> <span class="token parameter variable">-0500</span>

    Publish @travetto/asset,@travetto/asset-rest,@travetto/auth,@travetto/auth-model,@travetto/auth-rest,@travetto/auth-rest-jwt,@travetto/auth-rest-passport,@travetto/auth-rest-session,<span class="token punctuation">..</span>.</code></pre>
  </figure>

<h2 id="cli-publish">CLI - Publish</h2>

The publish functionality is relatively naive, but consistent.  The code will look at all modules in the mono-repo and check the listed version against what is available in the npm registry.  If the local version is newer, it is a candidate for publishing.

  <figure class="terminal">
    <figcaption class="terminal">Publish execution

</figcaption>
    <pre><code class="language-bash">$ trv repo:publish <span class="token parameter variable">-h</span>

Usage: repo:publish <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

Options:
  --dry-run, --no-dry-run  Dry Run? <span class="token punctuation">(</span>default: <span class="token boolean">true</span><span class="token punctuation">)</span>
  -h, <span class="token parameter variable">--help</span>               display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span></code></pre>
  </figure>

By default the tool will execute a dry run only, and requires passing a flag to disable the dry run.

  <figure class="terminal">
    <figcaption class="terminal">Publishing changes

</figcaption>
    <pre><code class="language-bash">npx trv repo:publish --no-dry-run</code></pre>
  </figure>

If no modules are currently changed, then the command will indicate there is no work to do, and exit gracefully.

<h2 id="cli-list">CLI - List</h2>

The listing functionality provides the ability to get the workspace modules in the following formats:

  <figure class="terminal">
    <figcaption class="terminal">List execution

</figcaption>
    <pre><code class="language-bash">$ trv repo:list <span class="token parameter variable">-h</span>

Usage: repo:list <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

Options:
  -c, <span class="token parameter variable">--changed</span>                   Only show changed modules <span class="token punctuation">(</span>default: <span class="token boolean">false</span><span class="token punctuation">)</span>
  -f, <span class="token parameter variable">--format</span> <span class="token operator">&lt;</span>graph<span class="token operator">|</span>json<span class="token operator">|</span>list<span class="token operator">></span>  Output <span class="token function">format</span> <span class="token punctuation">(</span>default: <span class="token string">"list"</span><span class="token punctuation">)</span>
  -fh, --from-hash <span class="token operator">&lt;</span>string<span class="token operator">></span>       Start revision to check against
  -th, --to-hash <span class="token operator">&lt;</span>string<span class="token operator">></span>         End revision to check against
  -h, <span class="token parameter variable">--help</span>                      display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span></code></pre>
  </figure>

<ul> <li><code class="item input">list</code> - Standard text list, each module on its own line</li>
<li><code class="item input">graph</code> - Modules as a digraph, mapping interdependencies</li>
<li><code class="item input">json</code> - Graph of modules in JSON form, with additional data (useful for quickly building a dependency graph)</li>
</ul>

  <figure class="terminal">
    <figcaption class="terminal">List execution of Monorepo

</figcaption>
    <pre><code class="language-bash">$ trv repo:list

global-test/asset-rest-upload
global-test/auth-rest
global-test/auth-rest-jwt
global-test/model_asset
global-test/model_auth-model
global-test/model_cache
global-test/model_rest-session
global-test/openapi
global-test/pack_app
global-test/rest-client
global-test/rest-session
global-test/rest-upload
global-test/transformer-test
module/asset
module/auth
module/auth-model
module/auth-rest
module/auth-rest-jwt
module/auth-rest-passport
module/auth-rest-session
module/base
module/cache
module/cli
module/command
module/compiler
module/config
module/context
module/di
module/doc
module/email
module/email-compiler
module/email-inky
module/email-nodemailer
module/eslint
module/image
module/jwt
module/log
module/manifest
module/model
module/model-dynamodb
module/model-elasticsearch
module/model-firestore
module/model-mongo
module/model-mysql
module/model-postgres
module/model-query
module/model-redis
module/model-s3
module/model-sql
module/model-sqlite
module/openapi
module/pack
module/registry
module/repo
module/rest
module/rest-aws-lambda
module/rest-client
module/rest-express
module/rest-express-lambda
module/rest-fastify
module/rest-fastify-lambda
module/rest-koa
module/rest-koa-lambda
module/rest-model
module/rest-model-query
module/rest-session
module/rest-upload
module/scaffold
module/schema
module/schema-faker
module/terminal
module/test
module/transformer
module/worker
node_modules/@travetto/asset-rest
related/todo-app</code></pre>
  </figure>

<h2 id="cli-exec">CLI - Exec</h2>

The exec command allows for running commands on all modules, or just changed modules.

  <figure class="terminal">
    <figcaption class="terminal">Exec execution

</figcaption>
    <pre><code class="language-bash">$ trv repo:exec <span class="token parameter variable">-h</span>

Usage: repo:exec <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>cmd:string<span class="token operator">></span> <span class="token punctuation">[</span>args<span class="token punctuation">..</span>.:string<span class="token punctuation">]</span>

Options:
  -c, <span class="token parameter variable">--changed</span>                        Only changed modules <span class="token punctuation">(</span>default: <span class="token boolean">false</span><span class="token punctuation">)</span>
  -w, <span class="token parameter variable">--workers</span> <span class="token operator">&lt;</span>number<span class="token operator">></span>               Number of concurrent workers <span class="token punctuation">(</span>default: <span class="token number">4</span><span class="token punctuation">)</span>
  --prefix-output, --no-prefix-output  Prefix output by folder <span class="token punctuation">(</span>default: <span class="token boolean">true</span><span class="token punctuation">)</span>
  --show-stdout, --no-show-stdout      Show stdout <span class="token punctuation">(</span>default: <span class="token boolean">true</span><span class="token punctuation">)</span>
  -h, <span class="token parameter variable">--help</span>                           display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span></code></pre>
  </figure>

The standard format includes prefixed output to help identify which module produced which output.

  <figure class="terminal">
    <figcaption class="terminal">List execution of Monorepo

</figcaption>
    <pre><code class="language-bash">$ trv repo:exec <span class="token builtin class-name">pwd</span>

global-test/asset-rest-upload ./global-test/asset-rest-upload
            global-test/auth-rest ./global-test/auth-rest
        global-test/auth-rest-jwt ./global-test/auth-rest-jwt
          global-test/model_asset ./global-test/model_asset
     global-test/model_auth-model ./global-test/model_auth-model
          global-test/model_cache ./global-test/model_cache
   global-test/model_rest-session ./global-test/model_rest-session
              global-test/openapi ./global-test/openapi
             global-test/pack_app ./global-test/pack_app
          global-test/rest-client ./global-test/rest-client
         global-test/rest-session ./global-test/rest-session
          global-test/rest-upload ./global-test/rest-upload
     global-test/transformer-test ./global-test/transformer-test
                     module/asset ./module/asset
node_modules/@travetto/asset-rest ./node_modules/@travetto/asset-rest
                      module/auth ./module/auth
                module/auth-model ./module/auth-model
                 module/auth-rest ./module/auth-rest
             module/auth-rest-jwt ./module/auth-rest-jwt
        module/auth-rest-passport ./module/auth-rest-passport
         module/auth-rest-session ./module/auth-rest-session
                      module/base ./module/base
                     module/cache ./module/cache
                       module/cli ./module/cli
                   module/command ./module/command
                  module/compiler ./module/compiler
                    module/config ./module/config
                   module/context ./module/context
                        module/di ./module/di
                       module/doc ./module/doc
                     module/email ./module/email
            module/email-compiler ./module/email-compiler
                module/email-inky ./module/email-inky
          module/email-nodemailer ./module/email-nodemailer
                    module/eslint ./module/eslint
                     module/image ./module/image
                       module/jwt ./module/jwt
                       module/log ./module/log
                  module/manifest ./module/manifest
                     module/model ./module/model
            module/model-dynamodb ./module/model-dynamodb
       module/model-elasticsearch ./module/model-elasticsearch
           module/model-firestore ./module/model-firestore
               module/model-mongo ./module/model-mongo
               module/model-mysql ./module/model-mysql
            module/model-postgres ./module/model-postgres
               module/model-query ./module/model-query
               module/model-redis ./module/model-redis
                  module/model-s3 ./module/model-s3
                 module/model-sql ./module/model-sql
              module/model-sqlite ./module/model-sqlite
                   module/openapi ./module/openapi
                      module/pack ./module/pack
                  module/registry ./module/registry
                      module/repo ./module/repo
                      module/rest ./module/rest
           module/rest-aws-lambda ./module/rest-aws-lambda
               module/rest-client ./module/rest-client
              module/rest-express ./module/rest-express
       module/rest-express-lambda ./module/rest-express-lambda
              module/rest-fastify ./module/rest-fastify
       module/rest-fastify-lambda ./module/rest-fastify-lambda
                  module/rest-koa ./module/rest-koa
           module/rest-koa-lambda ./module/rest-koa-lambda
                module/rest-model ./module/rest-model
          module/rest-model-query ./module/rest-model-query
              module/rest-session ./module/rest-session
               module/rest-upload ./module/rest-upload
                  module/scaffold ./module/scaffold
                    module/schema ./module/schema
              module/schema-faker ./module/schema-faker
                  module/terminal ./module/terminal
                      module/test ./module/test
                 related/todo-app ./related/todo-app
               module/transformer ./module/transformer
                    module/worker ./module/worker</code></pre>
  </figure>
