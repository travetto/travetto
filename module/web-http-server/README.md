<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/web-http-server/DOC.tsx and execute "npx trv doc" to rebuild -->
# Web HTTP Server Support

## Web HTTP Server Support

**Install: @travetto/web-http-server**
```bash
npm install @travetto/web-http-server

# or

yarn add @travetto/web-http-server
```

This module provides basic for running [http](https://nodejs.org/api/http.html) and [https](https://nodejs.org/api/https.html) servers.  It provides support for ssl key generation during development as well.

## Running a Server
By default, the framework provides a default [@CliCommand](https://github.com/travetto/travetto/tree/main/module/cli/src/decorators.ts#L84) for [WebHttpServer](https://github.com/travetto/travetto/tree/main/module/web-http-server/src/types.ts#L10) that will follow default behaviors, and spin up the server. Currently, [Node Web Server](https://github.com/travetto/travetto/tree/main/module/web-node#readme "Node provider for the travetto web module.") is the only module that provides a compatible [WebHttpServer](https://github.com/travetto/travetto/tree/main/module/web-http-server/src/types.ts#L10).

**Terminal: Standard application**
```bash
$ trv web:http

node:internal/modules/cjs/loader:1408
  throw err;
  ^

Error: Cannot find module '<workspace-root>/module/web/doc-exec/.trv/compiler/node_modules/@travetto/manifest/__index__.js'
Require stack:
- ./doc-exec/.trv/compiler/node_modules/@travetto/compiler/src/compiler.js
- ./doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.compiler.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1405:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1061:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1066:22)
    at Function._load (node:internal/modules/cjs/loader:1215:37)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Module.require (node:internal/modules/cjs/loader:1491:12)
    at require (node:internal/modules/helpers:135:16)
    at Object.<anonymous> (<workspace-root>/module/compiler/src/compiler.ts:4:1)
    at Module._compile (node:internal/modules/cjs/loader:1734:14) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
    './doc-exec/.trv/compiler/node_modules/@travetto/compiler/src/compiler.js',
    './doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.compiler.js'
  ]
}

Node.js v23.11.0
node:internal/modules/cjs/loader:1405
  const err = new Error(message);
              ^

Error: Cannot find module './doc-exec/.trv/output/node_modules/@travetto/cli/support/entry.trv.js'
Require stack:
- ./doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.main.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1405:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1061:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1066:22)
    at Function._load (node:internal/modules/cjs/loader:1215:37)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Module.require (node:internal/modules/cjs/loader:1491:12)
    at require (node:internal/modules/helpers:135:16)
    at <anonymous> (./doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/module.ts:107:98)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
    './doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.main.js'
  ]
}

Node.js v23.11.0
```

### Creating a Custom CLI Entry Point
To customize a Web server, you may need to construct an entry point using the [@CliCommand](https://github.com/travetto/travetto/tree/main/module/cli/src/decorators.ts#L84) decorator. This could look like:

**Code: Application entry point for Web Applications**
```typescript
import { Env, ShutdownManager, toConcrete } from '@travetto/runtime';
import { CliCommand } from '@travetto/cli';
import { DependencyRegistry } from '@travetto/di';
import { RootRegistry } from '@travetto/registry';
import { WebHttpServer, WebHttpConfig } from '@travetto/web-http-server';

import './config-override.ts';

@CliCommand({ runTarget: true })
export class SampleApp {

  preMain(): void {
    Env.TRV_ENV.set('prod');
    Env.NODE_ENV.set('production');
  }

  async main() {
    console.log('CUSTOM STARTUP');
    await RootRegistry.init();
    const ssl = await DependencyRegistry.getInstance(WebHttpConfig);
    ssl.ssl = true;

    // Configure server before running
    const instance = await DependencyRegistry.getInstance(toConcrete<WebHttpServer>());
    const { wait, kill } = await instance.serve();
    ShutdownManager.onGracefulShutdown(kill);
    return wait;
  }
}
```

And using the pattern established in the [Command Line Interface](https://github.com/travetto/travetto/tree/main/module/cli#readme "CLI infrastructure for Travetto framework") module, you would run your program using `npx trv web:custom`.

**Terminal: Custom application**
```bash
$ trv web:custom

node:internal/modules/cjs/loader:1408
  throw err;
  ^

Error: Cannot find module '<workspace-root>/module/web/doc-exec/.trv/compiler/node_modules/@travetto/manifest/__index__.js'
Require stack:
- ./doc-exec/.trv/compiler/node_modules/@travetto/compiler/src/compiler.js
- ./doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.compiler.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1405:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1061:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1066:22)
    at Function._load (node:internal/modules/cjs/loader:1215:37)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Module.require (node:internal/modules/cjs/loader:1491:12)
    at require (node:internal/modules/helpers:135:16)
    at Object.<anonymous> (<workspace-root>/module/compiler/src/compiler.ts:4:1)
    at Module._compile (node:internal/modules/cjs/loader:1734:14) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
    './doc-exec/.trv/compiler/node_modules/@travetto/compiler/src/compiler.js',
    './doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.compiler.js'
  ]
}

Node.js v23.11.0
node:internal/modules/cjs/loader:1405
  const err = new Error(message);
              ^

Error: Cannot find module './doc-exec/.trv/output/node_modules/@travetto/cli/support/entry.trv.js'
Require stack:
- ./doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.main.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1405:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1061:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1066:22)
    at Function._load (node:internal/modules/cjs/loader:1215:37)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Module.require (node:internal/modules/cjs/loader:1491:12)
    at require (node:internal/modules/helpers:135:16)
    at <anonymous> (./doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/module.ts:107:98)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [
    './doc-exec/.trv/compiler/node_modules/@travetto/compiler/support/entry.main.js'
  ]
}

Node.js v23.11.0
```

## SSL Support
Additionally the framework supports SSL out of the box, by allowing you to specify your public and private keys for the cert.  In dev mode, the framework will also automatically generate a self-signed cert if:
   *  SSL support is configured
   *  [node-forge](https://www.npmjs.com/package/node-forge) is installed
   *  Not running in prod
   *  No keys provided

This is useful for local development where you implicitly trust the cert. 

SSL support can be enabled by setting `web.http.ssl: true` in your config. The key/cert can be specified as string directly in the config file/environment variables.  The key/cert can also be specified as a path to be picked up by [RuntimeResources](https://github.com/travetto/travetto/tree/main/module/runtime/src/resources.ts#L8).
