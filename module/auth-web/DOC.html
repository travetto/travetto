<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/auth-web/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Web Auth
<small>Web authentication integration support for the Travetto framework</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install @travetto/auth-web
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/auth-web

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> @travetto/auth-web</code></pre>
  </figure>

This is a primary integration for the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/auth" title="Authentication scaffolding for the Travetto framework">Authentication</a> module with the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/web" title="Declarative support for creating Web Applications">Web API</a> module. <br><br>
The integration with the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/web" title="Declarative support for creating Web Applications">Web API</a> module touches multiple levels. Primarily:
<ul> <li>Authenticating</li>
<li>Maintaining Auth Context</li>
<li>Endpoint Decoration</li>
<li>Multi-Step Login</li>
</ul>

<h2 id="authenticating">Authenticating</h2>

Every external framework integration relies upon the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/authenticator.ts#L9">Authenticator</a> contract.  This contract defines the boundaries between both frameworks and what is needed to pass between. As stated elsewhere, the goal is to be as flexible as possible, and so the contract is as minimal as possible:

  <figure class="code">
    <figcaption class="code">Structure for the Identity Source
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/authenticator.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> AnyMap <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/runtime'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> Principal <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./principal.ts'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Represents the general shape of additional login context, usually across multiple calls
 *
 * @concrete
 */</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AuthenticatorState</span> <span class="token keyword">extends</span> <span class="token class-name">AnyMap</span> <span class="token punctuation">{{'{'}}</span> <span class="token punctuation">{{'}'}}</span>

<span class="token comment">/**
 * Supports validation payload of type T into an authenticated principal
 *
 * @concrete
 */</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Authenticator<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> <span class="token constant">P</span> <span class="token keyword">extends</span> Principal <span class="token operator">=</span> Principal<span class="token operator">></span></span> <span class="token punctuation">{{'{'}}</span>
  <span class="token comment">/**
   * Retrieve the authenticator state for the given request
   */</span>
  getState<span class="token operator">?</span><span class="token punctuation">(</span>context<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AuthenticatorState <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token operator">|</span> AuthenticatorState <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * Verify the payload, ensuring the payload is correctly identified.
   *
   * @returns Valid principal if authenticated
   * @returns undefined if authentication is valid, but incomplete (multi-step)
   * @throws Error if authentication fails
   */</span>
  <span class="token function">authenticate</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> context<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token constant">P</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

The only required method to be defined is the <code class="item method">authenticate</code> method.  This takes in a pre-principal payload and a filter context with a <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web/src/types/request.ts#L11">WebRequest</a>, and is responsible for:
<ul> <li>Returning an <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/principal.ts#L7">Principal</a> if authentication was successful</li>
<li>Throwing an error if it failed</li>
<li>Returning undefined if the authentication is multi-staged and has not completed yet</li>
</ul>
A sample auth provider would look like:

  <figure class="code">
    <figcaption class="code">Sample Identity Source
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth-web/doc/source.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> AuthenticationError<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">Authenticator</span> <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token operator">=</span> <span class="token punctuation">{{'{'}}</span> username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SimpleAuthenticator</span> <span class="token keyword">implements</span> <span class="token class-name">Authenticator<span class="token operator">&lt;</span>User<span class="token operator">></span></span> <span class="token punctuation">{{'{'}}</span>
  <span class="token keyword">async</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> username<span class="token punctuation">,</span> password <span class="token punctuation">{{'}'}}</span><span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">===</span> <span class="token string">'test'</span> <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> <span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{{'{'}}</span>
        id<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
        source<span class="token operator">:</span> <span class="token string">'simple'</span><span class="token punctuation">,</span>
        permissions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        details<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span>
          username<span class="token operator">:</span> <span class="token string">'test'</span>
        <span class="token punctuation">{{'}'}}</span>
      <span class="token punctuation">{{'}'}}</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span> <span class="token keyword">else</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationError</span><span class="token punctuation">(</span><span class="token string">'Invalid credentials'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

The provider must be registered with a custom symbol to be used within the framework.  At startup, all registered <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/authenticator.ts#L9">Authenticator</a>'s are collected and stored for reference at runtime, via symbol. For example:

  <figure class="code">
    <figcaption class="code">Potential Facebook provider
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth-web/doc/facebook.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> InjectableFactory <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/di'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> SimpleAuthenticator <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./source.ts'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> FbAuthSymbol <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'auth-facebook'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{{'{'}}</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">InjectableFactory</span></span><span class="token punctuation">(</span>FbAuthSymbol<span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">facebookIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

The symbol <code class="item input">FB_AUTH</code> is what will be used to reference providers at runtime.  This was chosen, over <code class="item input">class</code> references due to the fact that most providers will not be defined via a new class, but via an <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/di/src/decorator.ts#L48">@InjectableFactory</a> method.

<h2 id="maintaining-auth-context">Maintaining Auth Context</h2>

The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/interceptors/context.ts#L20">AuthContextInterceptor</a> acts as the bridge between the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/auth" title="Authentication scaffolding for the Travetto framework">Authentication</a> and <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/web" title="Declarative support for creating Web Applications">Web API</a> modules.  It serves to take an authenticated principal (via the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web/src/types/request.ts#L11">WebRequest</a>/<a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web/src/types/response.ts#L3">WebResponse</a>) and integrate it into the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/context.ts#L14">AuthContext</a>. Leveraging <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/config.ts#L8">WebAuthConfig</a>'s configuration allows for basic control of how the principal is encoded and decoded, primarily with the choice between using a header or a cookie, and which header, or cookie value is specifically referenced.  Additionally, the encoding process allows for auto-renewing of the token (on by default). The information is encoded into the <a target="_blank" class="external-link" href="https://jwt.io/">JWT</a> appropriately, and when encoding using cookies, is also  set as the expiry time for the cookie.  <br><br>
<strong>Note for Cookie Use:</strong> The automatic renewal, update, seamless receipt and transmission of the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/principal.ts#L7">Principal</a> cookie act as a light-weight session.  Generally the goal is to keep the token as small as possible, but for small amounts of data, this pattern proves to be fairly sufficient at maintaining a decentralized state. <br><br>
The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/types.ts#L10">PrincipalCodec</a> contract is the primary interface for reading and writing <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/principal.ts#L7">Principal</a> data out of the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web/src/types/request.ts#L11">WebRequest</a>. This contract is flexible by design, allowing for all sorts of usage. <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/codec.ts#L15">JWTPrincipalCodec</a> is the default <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/types.ts#L10">PrincipalCodec</a>, leveraging <a target="_blank" class="external-link" href="https://jwt.io/">JWT</a> s for encoding/decoding the principal information.

  <figure class="code">
    <figcaption class="code">JWTPrincipalCodec
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/codec.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> Jwt<span class="token punctuation">,</span> Verifier<span class="token punctuation">,</span> SupportedAlgorithms <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'njwt'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> <span class="token keyword">type</span> <span class="token class-name">AuthContext</span><span class="token punctuation">,</span> AuthenticationError<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">AuthToken</span><span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">Principal</span> <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Injectable<span class="token punctuation">,</span> Inject <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/di'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> <span class="token keyword">type</span> <span class="token class-name">WebResponse</span><span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">WebRequest</span><span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">WebAsyncContext</span><span class="token punctuation">,</span> CookieJar <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/web'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> RuntimeError<span class="token punctuation">,</span> castTo<span class="token punctuation">,</span> TimeUtil <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/runtime'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> CommonPrincipalCodecSymbol<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">PrincipalCodec</span> <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./types.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> WebAuthConfig <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./config.ts'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * JWT Principal codec
 */</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span>CommonPrincipalCodecSymbol<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JWTPrincipalCodec</span> <span class="token keyword">implements</span> <span class="token class-name">PrincipalCodec</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  config<span class="token operator">:</span> WebAuthConfig<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  authContext<span class="token operator">:</span> AuthContext<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  webAsyncContext<span class="token operator">:</span> WebAsyncContext<span class="token punctuation">;</span>

  #verifier<span class="token operator">:</span> Verifier<span class="token punctuation">;</span>
  #algorithm<span class="token operator">:</span> SupportedAlgorithms <span class="token operator">=</span> <span class="token string">'HS256'</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">postConstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token comment">// Weird issue with their ES module support</span>
    <span class="token keyword">const</span> <span class="token punctuation">{{'{'}}</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> createVerifier <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'}'}}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'njwt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#verifier <span class="token operator">=</span> <span class="token function">createVerifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setSigningAlgorithm</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#algorithm<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withKeyResolver</span><span class="token punctuation">(</span><span class="token punctuation">(</span>keyId<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{{'{'}}</span>
        <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>keyMap<span class="token punctuation">[</span>keyId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>entry <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationError</span><span class="token punctuation">(</span><span class="token string">'Invalid'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token keyword">async</span> <span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Principal<span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">const</span> jwt<span class="token operator">:</span> Jwt <span class="token operator">&amp;</span> <span class="token punctuation">{{'{'}}</span> body<span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> core<span class="token operator">:</span> Principal <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'}'}}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>#verifier<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> verified<span class="token punctuation">)</span> <span class="token operator">=></span> error <span class="token operator">?</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">castTo</span><span class="token punctuation">(</span>verified<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> jwt<span class="token punctuation">.</span>body<span class="token punctuation">.</span>core<span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'Jwt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationError</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> category<span class="token operator">:</span> <span class="token string">'permissions'</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">{{'}'}}</span>
      <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token function">token</span><span class="token punctuation">(</span>request<span class="token operator">:</span> WebRequest<span class="token punctuation">)</span><span class="token operator">:</span> AuthToken <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'header'</span><span class="token punctuation">)</span> <span class="token operator">?</span>
      request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">getWithPrefix</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>header<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>headerPrefix<span class="token punctuation">)</span> <span class="token operator">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>webAsyncContext<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>CookieJar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>cookie<span class="token punctuation">,</span> <span class="token punctuation">{{'{'}}</span> signed<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> value <span class="token operator">?</span> <span class="token punctuation">{{'{'}}</span> type<span class="token operator">:</span> <span class="token string">'jwt'</span><span class="token punctuation">,</span> value <span class="token punctuation">{{'}'}}</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token keyword">async</span> <span class="token function">decode</span><span class="token punctuation">(</span>request<span class="token operator">:</span> WebRequest<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Principal <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> token <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>value<span class="token operator">:</span> Principal<span class="token punctuation">,</span> keyId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'default'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>keyMap<span class="token punctuation">[</span>keyId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeError</span><span class="token punctuation">(</span><span class="token string">'Requested unknown key for signing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token comment">// Weird issue with their ES module support</span>
    <span class="token keyword">const</span> <span class="token punctuation">{{'{'}}</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{{'{'}}</span> create <span class="token punctuation">{{'}'}}</span> <span class="token punctuation">{{'}'}}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'njwt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span><span class="token punctuation">{{'}'}}</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>expiresAt<span class="token operator">!</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setIssuedAt</span><span class="token punctuation">(</span>TimeUtil<span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>issuedAt <span class="token operator">??</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setClaim</span><span class="token punctuation">(</span><span class="token string">'core'</span><span class="token punctuation">,</span> <span class="token function">castTo</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> <span class="token operator">...</span>value <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setIssuer</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>issuer<span class="token operator">!</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setJti</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>sessionId<span class="token operator">!</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'kid'</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setSigningAlgorithm</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jwt<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token keyword">async</span> <span class="token function">encode</span><span class="token punctuation">(</span>response<span class="token operator">:</span> WebResponse<span class="token punctuation">,</span> data<span class="token operator">:</span> Principal <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>WebResponse<span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> data <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{{'{'}}</span> header<span class="token punctuation">,</span> headerPrefix<span class="token punctuation">,</span> cookie <span class="token punctuation">{{'}'}}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'header'</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">setWithPrefix</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> token<span class="token punctuation">,</span> headerPrefix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span> <span class="token keyword">else</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>webAsyncContext<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>CookieJar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{{'{'}}</span> name<span class="token operator">:</span> cookie<span class="token punctuation">,</span> value<span class="token operator">:</span> token<span class="token punctuation">,</span> signed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> expires<span class="token operator">:</span> data<span class="token operator">?.</span>expiresAt <span class="token punctuation">{{'}'}}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

As you can see, the encode token just creates a <a target="_blank" class="external-link" href="https://jwt.io/">JWT</a> based on the principal provided, and decoding verifies the token, and returns the principal. <br><br>
A trivial/sample custom <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/types.ts#L10">PrincipalCodec</a> can be seen here:

  <figure class="code">
    <figcaption class="code">Custom Principal Codec
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth-web/doc/codec.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> Principal <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> PrincipalCodec <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth-web'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Injectable <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/di'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> BinaryMetadataUtil <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/runtime'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> WebResponse<span class="token punctuation">,</span> WebRequest <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/web'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CustomCodec</span> <span class="token keyword">implements</span> <span class="token class-name">PrincipalCodec</span> <span class="token punctuation">{{'{'}}</span>
  secret<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token function">decode</span><span class="token punctuation">(</span>request<span class="token operator">:</span> WebRequest<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Principal <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token operator">|</span> Principal <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>userId<span class="token punctuation">,</span> sig<span class="token punctuation">]</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'USER_ID'</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userId <span class="token operator">&amp;&amp;</span> sig <span class="token operator">===</span> BinaryMetadataUtil<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>userId <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">let</span> principal<span class="token operator">:</span> Principal <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
      <span class="token comment">// Lookup user from db, remote system, etc.,</span>
      <span class="token keyword">return</span> principal<span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
  <span class="token function">encode</span><span class="token punctuation">(</span>response<span class="token operator">:</span> WebResponse<span class="token punctuation">,</span> data<span class="token operator">:</span> Principal <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> WebResponse <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
      response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'USER_ID'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span>data<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{'{'}}</span>BinaryMetadataUtil<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">{{'}'}}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

This implementation is not suitable for production, but shows the general pattern needed to integrate with any principal source.

<h2 id="endpoint-decoration">Endpoint Decoration</h2>

<a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/decorator.ts#L13">@Login</a> integrates with middleware that will authenticate the user as defined by the specified providers, or throw an error if authentication is unsuccessful.<br><br>
<a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/decorator.ts#L56">@Logout</a> integrates with middleware that will automatically deauthenticate a user, throw an error if the user is unauthenticated.

  <figure class="code">
    <figcaption class="code">Using provider with endpoints
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth-web/doc/endpoints.ts">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> ContextParam<span class="token punctuation">,</span> WebResponse <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/web'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> Login<span class="token punctuation">,</span> Authenticated<span class="token punctuation">,</span> Logout <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth-web'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{{'{'}}</span> Principal <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'@travetto/auth'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{{'{'}}</span> FbAuthSymbol <span class="token punctuation">{{'}'}}</span> <span class="token keyword">from</span> <span class="token string">'./facebook.ts'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SampleAuth</span> <span class="token punctuation">{{'{'}}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ContextParam</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  user<span class="token operator">:</span> Principal<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'/simple'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Login</span></span><span class="token punctuation">(</span>FbAuthSymbol<span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">simpleLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> WebResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/auth/self'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'/self'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Authenticated</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Logout</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">return</span> WebResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/auth/self'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

<a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/decorator.ts#L29">@Authenticated</a> and <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web/src/decorator.ts#L45">@Unauthenticated</a> will simply enforce whether or not a user is logged in and throw the appropriate error messages as needed. Additionally, the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/principal.ts#L7">Principal</a> is accessible as a resource that can be exposed as a <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/web/src/decorator/param.ts#L64">@ContextParam</a> on an <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/di/src/decorator.ts#L16">@Injectable</a> class.

<h2 id="multi-step-login">Multi-Step Login</h2>

When authenticating, with a multi-step process, it is useful to share information between steps.  The <code class="item field">authenticatorState</code> of <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/context.ts#L14">AuthContext</a> field is intended to be a location in which that information is persisted. Currently only <a target="_blank" class="external-link" href="http://passportjs.org">passport</a> support is included, when dealing with multi-step logins. This information can also be injected into a web endpoint method, using the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/authenticator.ts#L9">AuthenticatorState</a> type;
