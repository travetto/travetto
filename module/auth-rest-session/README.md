<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/auth-rest-session/DOC.tsx and execute "npx trv doc" to rebuild -->
# Rest Auth Session

## Rest authentication session integration support for the Travetto framework

**Install: @travetto/auth-rest-session**
```bash
npm install @travetto/auth-rest-session

# or

yarn add @travetto/auth-rest-session
```

One of [Rest Auth](https://github.com/travetto/travetto/tree/main/module/auth-rest#readme "Rest authentication integration support for the Travetto framework")'s main responsibilities is being able to send and receive authentication/authorization information from the client. 

This module's responsibility is, to expose [Auth Session](https://github.com/travetto/travetto/tree/main/module/auth-session#readme "Session provider for the travetto auth module.")'s data, within the scope of the request/response flow.

**Code: Anatomy of the Session Interceptor**
```typescript
class RestSessionConfig implements ManagedInterceptorConfig { }

/**
 * Loads session, and provides ability to create session as needed, persists when complete.
 */
@Injectable()
export class SessionInterceptor implements RestInterceptor {

  dependsOn: Class<RestInterceptor>[] = [AuthReadWriteInterceptor];
  runsBefore: Class<RestInterceptor>[] = [];

  @Inject()
  service: SessionService;

  @Inject()
  config: RestSessionConfig;

  async intercept(ctx: FilterContext, next: FilterNext): Promise<unknown> {
    try {
      await this.service.load();
      Object.defineProperty(ctx.req, 'session', { get: () => this.service.getOrCreate() });
      return await next();
    } finally {
      await this.service.persist();
    }
  }
}
```

Once operating within the [Session](https://github.com/travetto/travetto/tree/main/module/auth-session/src/session.ts#L13) boundaries, the session state can be injected via params, or accessed via the [SessionService](https://github.com/travetto/travetto/tree/main/module/auth-session/src/service.ts#L16).

**Code: Sample Usage**
```typescript
@Authenticated()
@Controller('/session')
export class SessionRoutes {

  @Inject()
  service: SessionService;

  @Put('/info')
  async storeInfo(data?: SessionData) {
    if (data) {
      data.age = 20;
      data.name = 'Roger'; // Setting data
    }
  }

  @Get('/logout')
  async logout() {
    await this.service.destroy();
  }

  @Get('/info/age')
  async getInfo() {
    const { data } = this.service.getOrCreate();
    return data?.age;
  }
}
```
