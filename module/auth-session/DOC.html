<!-- This file was generated by @travetto/doc and should not be modified directly -->
<!-- Please modify https://github.com/travetto/travetto/tree/main/module/auth-session/DOC.tsx and execute "npx trv doc" to rebuild -->
<h1>Auth Session
<small>Session provider for the travetto auth module.</small>
</h1>

  <figure class="install">
    <figcaption class="install">Install @travetto/auth-session
    
    </figcaption>
    <pre><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @travetto/auth-session

<span class="token comment"># or</span>

<span class="token function">yarn</span> <span class="token function">add</span> @travetto/auth-session</code></pre>
  </figure>

This is a module that adds session support to the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/auth" title="Authentication scaffolding for the Travetto framework">Authentication</a> framework, via <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model" title="Datastore abstraction for core operations.">Data Modeling Support</a> storage.  The concept here, is that the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/auth" title="Authentication scaffolding for the Travetto framework">Authentication</a> module provides the solid foundation for ensuring authentication to the system, and transitively to the session data. The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/types/principal.ts#L7">Principal</a> provides a session identifier, which refers to a unique authentication session.  Each login will produce a novel session id.  This id provides the contract between <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/auth" title="Authentication scaffolding for the Travetto framework">Authentication</a> and<a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/auth-session" title="Session provider for the travetto auth module.">Auth Session</a>.  <br><br>
This session identifier, is then used when retrieving data from <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model" title="Datastore abstraction for core operations.">Data Modeling Support</a> storage. This storage mechanism is not tied to a request/response model, but the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/auth-web-session" title="Web authentication session integration support for the Travetto framework">Web Auth Session</a> does provide a natural integration with the <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/web" title="Declarative api for Web Applications with support for the dependency injection.">Web API</a> module.   <br><br>
Within the framework the sessions are stored against any <a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model" title="Datastore abstraction for core operations.">Data Modeling Support</a> implementation that provides <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/model/src/types/expiry.ts#L10">ModelExpirySupport</a>, as the data needs to be able to be expired appropriately.  The list of supported model providers are:
<ul> <li><a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model-redis" title="Redis backing for the travetto model module.">Redis Model Support</a></li>
<li><a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model-mongo" title="Mongo backing for the travetto model module.">MongoDB Model Support</a></li>
<li><a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model-s3" title="S3 backing for the travetto model module.">S3 Model Support</a></li>
<li><a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model-dynamodb" title="DynamoDB backing for the travetto model module.">DynamoDB Model Support</a></li>
<li><a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model-elasticsearch" title="Elasticsearch backing for the travetto model module, with real-time modeling support for Elasticsearch mappings.">Elasticsearch Model Source</a></li>
<li><a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model-file" title="File system backing for the travetto model module.">File Model Support</a></li>
<li><a class="module-link" href="https://github.com/travetto/travetto/tree/main/module/model-memory" title="Memory backing for the travetto model module.">Memory Model Support</a></li>
</ul>
While the expiry is not necessarily a hard requirement, the implementation without it can be quite messy.  To that end, the ability to add <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/model/src/types/expiry.ts#L10">ModelExpirySupport</a> to the model provider would be the natural extension point if more expiry support is needed.

  <figure class="code">
    <figcaption class="code">Sample usage of Session Service
<cite><a target="_blank" href="https://github.com/travetto/travetto/tree/main/module/auth-web-session/src/interceptor.ts#L9">Source</a></cite>

</figcaption>
    <pre><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">WebSessionConfig</span> <span class="token punctuation">{{'{'}}</span> <span class="token punctuation">{{'}'}}</span>

<span class="token comment">/**
 * Loads session, and provides ability to create session as needed, persists when complete.
 */</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthSessionInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{{'{'}}</span>

  category<span class="token operator">:</span> HttpInterceptorCategory <span class="token operator">=</span> <span class="token string">'application'</span><span class="token punctuation">;</span>
  dependsOn <span class="token operator">=</span> <span class="token punctuation">[</span>AuthContextInterceptor<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  service<span class="token operator">:</span> SessionService<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  context<span class="token operator">:</span> SessionContext<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  config<span class="token operator">:</span> WebSessionConfig<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  webContext<span class="token operator">:</span> WebContext<span class="token punctuation">;</span>

  <span class="token function">postConstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webContext<span class="token punctuation">.</span><span class="token function">registerType</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">toConcrete</span><span class="token generic class-name"><span class="token operator">&lt;</span>Session<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webContext<span class="token punctuation">.</span><span class="token function">registerType</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">toConcrete</span><span class="token generic class-name"><span class="token operator">&lt;</span>SessionData<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{'}'}}</span>

  <span class="token keyword">async</span> <span class="token function">filter</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> HttpContext<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">></span> <span class="token punctuation">{{'{'}}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span> <span class="token keyword">finally</span> <span class="token punctuation">{{'{'}}</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{'}'}}</span>
  <span class="token punctuation">{{'}'}}</span>
<span class="token punctuation">{{'}'}}</span></code></pre>
  </figure>

The <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth-session/src/service.ts#L14">SessionService</a> provides the basic integration with the <a target="_blank" class="source-link" href="https://github.com/travetto/travetto/tree/main/module/auth/src/context.ts#L14">AuthContext</a> to authenticate and isolate session data.  The usage is fairly simple, but the import pattern to follow is:
<ul> <li>load</li>
<li>read/modify</li>
<li>persist</li>
</ul>
And note, persist is intelligent enough to only update the data store if the expiration date has changed or if the data in the session has been modified.
